'use strict';function cov_1nm72ljyco(){var path="/Users/priyankaverma/IdeaProjects/pcq-frontend/app/middleware/optOut.js";var hash="9467adc6da510d8a64d2d67653d526ab9187dd11";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/priyankaverma/IdeaProjects/pcq-frontend/app/middleware/optOut.js",statementMap:{"0":{start:{line:3,column:15},end:{line:3,column:32}},"1":{start:{line:4,column:22},end:{line:4,column:56}},"2":{start:{line:5,column:15},end:{line:5,column:32}},"3":{start:{line:7,column:18},end:{line:32,column:1}},"4":{start:{line:8,column:18},end:{line:8,column:35}},"5":{start:{line:9,column:26},end:{line:9,column:51}},"6":{start:{line:10,column:21},end:{line:13,column:5}},"7":{start:{line:15,column:17},end:{line:15,column:33}},"8":{start:{line:16,column:4},end:{line:16,column:48}},"9":{start:{line:19,column:4},end:{line:19,column:22}},"10":{start:{line:22,column:4},end:{line:22,column:44}},"11":{start:{line:24,column:21},end:{line:24,column:56}},"12":{start:{line:25,column:4},end:{line:31,column:11}},"13":{start:{line:27,column:12},end:{line:27,column:31}},"14":{start:{line:30,column:12},end:{line:30,column:35}},"15":{start:{line:34,column:15},end:{line:42,column:1}},"16":{start:{line:35,column:17},end:{line:35,column:33}},"17":{start:{line:37,column:4},end:{line:39,column:5}},"18":{start:{line:38,column:8},end:{line:38,column:35}},"19":{start:{line:41,column:4},end:{line:41,column:54}},"20":{start:{line:44,column:0},end:{line:44,column:24}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:7,column:18},end:{line:7,column:19}},loc:{start:{line:7,column:32},end:{line:32,column:1}},line:7},"1":{name:"(anonymous_1)",decl:{start:{line:26,column:15},end:{line:26,column:16}},loc:{start:{line:26,column:22},end:{line:28,column:9}},line:26},"2":{name:"(anonymous_2)",decl:{start:{line:29,column:17},end:{line:29,column:18}},loc:{start:{line:29,column:23},end:{line:31,column:9}},line:29},"3":{name:"(anonymous_3)",decl:{start:{line:34,column:15},end:{line:34,column:16}},loc:{start:{line:34,column:29},end:{line:42,column:1}},line:34}},branchMap:{"0":{loc:{start:{line:22,column:22},end:{line:22,column:43}},type:"binary-expr",locations:[{start:{line:22,column:22},end:{line:22,column:37}},{start:{line:22,column:41},end:{line:22,column:43}}],line:22},"1":{loc:{start:{line:24,column:21},end:{line:24,column:56}},type:"binary-expr",locations:[{start:{line:24,column:21},end:{line:24,column:42}},{start:{line:24,column:46},end:{line:24,column:56}}],line:24},"2":{loc:{start:{line:37,column:4},end:{line:39,column:5}},type:"if",locations:[{start:{line:37,column:4},end:{line:39,column:5}},{start:{line:37,column:4},end:{line:39,column:5}}],line:37},"3":{loc:{start:{line:41,column:17},end:{line:41,column:52}},type:"binary-expr",locations:[{start:{line:41,column:17},end:{line:41,column:38}},{start:{line:41,column:42},end:{line:41,column:52}}],line:41}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},f:{"0":0,"1":0,"2":0,"3":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"9467adc6da510d8a64d2d67653d526ab9187dd11"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1nm72ljyco=function(){return actualCoverage;};}return actualCoverage;}cov_1nm72ljyco();const config=(cov_1nm72ljyco().s[0]++,require('config'));const ServiceMapper=(cov_1nm72ljyco().s[1]++,require('app/utils/ServiceMapper'));const moment=(cov_1nm72ljyco().s[2]++,require('moment'));cov_1nm72ljyco().s[3]++;const setOptOut=(req,res)=>{cov_1nm72ljyco().f[0]++;const token=(cov_1nm72ljyco().s[4]++,req.session.token);const correlationId=(cov_1nm72ljyco().s[5]++,req.session.correlationId);const formData=(cov_1nm72ljyco().s[6]++,ServiceMapper.map('FormData',[config.services.pcqBackend.url,req.session.id]));// Set the completed date
const form=(cov_1nm72ljyco().s[7]++,req.session.form);cov_1nm72ljyco().s[8]++;form.completedDate=moment().toISOString();// Set the opt out flag
cov_1nm72ljyco().s[9]++;form.optOut='Y';//set pcqAnswers to empty to call backend in anycase continue or optout
cov_1nm72ljyco().s[10]++;form.pcqAnswers=(cov_1nm72ljyco().b[0][0]++,form.pcqAnswers)||(cov_1nm72ljyco().b[0][1]++,{});const redirect=(cov_1nm72ljyco().s[11]++,(cov_1nm72ljyco().b[1][0]++,req.session.returnUrl)||(cov_1nm72ljyco().b[1][1]++,'/offline'));cov_1nm72ljyco().s[12]++;return formData.post(token,correlationId,form).catch(err=>{cov_1nm72ljyco().f[1]++;cov_1nm72ljyco().s[13]++;req.log.error(err);}).finally(()=>{cov_1nm72ljyco().f[2]++;cov_1nm72ljyco().s[14]++;res.redirect(redirect);});};cov_1nm72ljyco().s[15]++;const optOut=(req,res)=>{cov_1nm72ljyco().f[3]++;const form=(cov_1nm72ljyco().s[16]++,req.session.form);// Now in all case we are creating a backend record either user has continued or optout.
cov_1nm72ljyco().s[17]++;if(!('optOut'in form)){cov_1nm72ljyco().b[2][0]++;cov_1nm72ljyco().s[18]++;return setOptOut(req,res);}else{cov_1nm72ljyco().b[2][1]++;}cov_1nm72ljyco().s[19]++;res.redirect((cov_1nm72ljyco().b[3][0]++,req.session.returnUrl)||(cov_1nm72ljyco().b[3][1]++,'/offline'));};cov_1nm72ljyco().s[20]++;module.exports=optOut;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb25maWciLCJyZXF1aXJlIiwiU2VydmljZU1hcHBlciIsIm1vbWVudCIsInNldE9wdE91dCIsInJlcSIsInJlcyIsInRva2VuIiwic2Vzc2lvbiIsImNvcnJlbGF0aW9uSWQiLCJmb3JtRGF0YSIsIm1hcCIsInNlcnZpY2VzIiwicGNxQmFja2VuZCIsInVybCIsImlkIiwiZm9ybSIsImNvbXBsZXRlZERhdGUiLCJ0b0lTT1N0cmluZyIsIm9wdE91dCIsInBjcUFuc3dlcnMiLCJyZWRpcmVjdCIsInJldHVyblVybCIsInBvc3QiLCJjYXRjaCIsImVyciIsImxvZyIsImVycm9yIiwiZmluYWxseSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJvcHRPdXQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBjb25maWcgPSByZXF1aXJlKCdjb25maWcnKTtcbmNvbnN0IFNlcnZpY2VNYXBwZXIgPSByZXF1aXJlKCdhcHAvdXRpbHMvU2VydmljZU1hcHBlcicpO1xuY29uc3QgbW9tZW50ID0gcmVxdWlyZSgnbW9tZW50Jyk7XG5cbmNvbnN0IHNldE9wdE91dCA9IChyZXEsIHJlcykgPT4ge1xuICAgIGNvbnN0IHRva2VuID0gcmVxLnNlc3Npb24udG9rZW47XG4gICAgY29uc3QgY29ycmVsYXRpb25JZCA9IHJlcS5zZXNzaW9uLmNvcnJlbGF0aW9uSWQ7XG4gICAgY29uc3QgZm9ybURhdGEgPSBTZXJ2aWNlTWFwcGVyLm1hcChcbiAgICAgICAgJ0Zvcm1EYXRhJyxcbiAgICAgICAgW2NvbmZpZy5zZXJ2aWNlcy5wY3FCYWNrZW5kLnVybCwgcmVxLnNlc3Npb24uaWRdXG4gICAgKTtcbiAgICAvLyBTZXQgdGhlIGNvbXBsZXRlZCBkYXRlXG4gICAgY29uc3QgZm9ybSA9IHJlcS5zZXNzaW9uLmZvcm07XG4gICAgZm9ybS5jb21wbGV0ZWREYXRlID0gbW9tZW50KCkudG9JU09TdHJpbmcoKTtcblxuICAgIC8vIFNldCB0aGUgb3B0IG91dCBmbGFnXG4gICAgZm9ybS5vcHRPdXQgPSAnWSc7XG5cbiAgICAvL3NldCBwY3FBbnN3ZXJzIHRvIGVtcHR5IHRvIGNhbGwgYmFja2VuZCBpbiBhbnljYXNlIGNvbnRpbnVlIG9yIG9wdG91dFxuICAgIGZvcm0ucGNxQW5zd2VycyA9IGZvcm0ucGNxQW5zd2VycyB8fCB7fTtcblxuICAgIGNvbnN0IHJlZGlyZWN0ID0gcmVxLnNlc3Npb24ucmV0dXJuVXJsIHx8ICcvb2ZmbGluZSc7XG4gICAgcmV0dXJuIGZvcm1EYXRhLnBvc3QodG9rZW4sIGNvcnJlbGF0aW9uSWQsIGZvcm0pXG4gICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgcmVxLmxvZy5lcnJvcihlcnIpO1xuICAgICAgICB9KVxuICAgICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgICAgICByZXMucmVkaXJlY3QocmVkaXJlY3QpO1xuICAgICAgICB9KTtcbn07XG5cbmNvbnN0IG9wdE91dCA9IChyZXEsIHJlcykgPT4ge1xuICAgIGNvbnN0IGZvcm0gPSByZXEuc2Vzc2lvbi5mb3JtO1xuICAgIC8vIE5vdyBpbiBhbGwgY2FzZSB3ZSBhcmUgY3JlYXRpbmcgYSBiYWNrZW5kIHJlY29yZCBlaXRoZXIgdXNlciBoYXMgY29udGludWVkIG9yIG9wdG91dC5cbiAgICBpZiAoISgnb3B0T3V0JyBpbiBmb3JtKSkge1xuICAgICAgICByZXR1cm4gc2V0T3B0T3V0KHJlcSwgcmVzKTtcbiAgICB9XG5cbiAgICByZXMucmVkaXJlY3QocmVxLnNlc3Npb24ucmV0dXJuVXJsIHx8ICcvb2ZmbGluZScpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBvcHRPdXQ7XG4iXSwibWFwcGluZ3MiOiJBQUFBLGEsMHpHQWVZOzJGQWJaLEtBQU1BLE9BQU0sMEJBQUdDLE9BQU8sQ0FBQyxRQUFELENBQVYsQ0FBWixDQUNBLEtBQU1DLGNBQWEsMEJBQUdELE9BQU8sQ0FBQyx5QkFBRCxDQUFWLENBQW5CLENBQ0EsS0FBTUUsT0FBTSwwQkFBR0YsT0FBTyxDQUFDLFFBQUQsQ0FBVixDQUFaLEMsd0JBRUEsS0FBTUcsVUFBUyxDQUFHLENBQUNDLEdBQUQsQ0FBTUMsR0FBTixHQUFjLHlCQUM1QixLQUFNQyxNQUFLLDBCQUFHRixHQUFHLENBQUNHLE9BQUosQ0FBWUQsS0FBZixDQUFYLENBQ0EsS0FBTUUsY0FBYSwwQkFBR0osR0FBRyxDQUFDRyxPQUFKLENBQVlDLGFBQWYsQ0FBbkIsQ0FDQSxLQUFNQyxTQUFRLDBCQUFHUixhQUFhLENBQUNTLEdBQWQsQ0FDYixVQURhLENBRWIsQ0FBQ1gsTUFBTSxDQUFDWSxRQUFQLENBQWdCQyxVQUFoQixDQUEyQkMsR0FBNUIsQ0FBaUNULEdBQUcsQ0FBQ0csT0FBSixDQUFZTyxFQUE3QyxDQUZhLENBQUgsQ0FBZCxDQUlBO0FBQ0EsS0FBTUMsS0FBSSwwQkFBR1gsR0FBRyxDQUFDRyxPQUFKLENBQVlRLElBQWYsQ0FBVixDQVI0Qix3QkFTNUJBLElBQUksQ0FBQ0MsYUFBTCxDQUFxQmQsTUFBTSxHQUFHZSxXQUFULEVBQXJCLENBRUE7QUFYNEIsd0JBWTVCRixJQUFJLENBQUNHLE1BQUwsQ0FBYyxHQUFkLENBRUE7QUFkNEIseUJBZTVCSCxJQUFJLENBQUNJLFVBQUwsQ0FBa0IsNEJBQUFKLElBQUksQ0FBQ0ksVUFBTCwrQkFBbUIsRUFBbkIsQ0FBbEIsQ0FFQSxLQUFNQyxTQUFRLDJCQUFHLDRCQUFBaEIsR0FBRyxDQUFDRyxPQUFKLENBQVljLFNBQVosK0JBQXlCLFVBQXpCLENBQUgsQ0FBZCxDQWpCNEIseUJBa0I1QixNQUFPWixTQUFRLENBQUNhLElBQVQsQ0FBY2hCLEtBQWQsQ0FBcUJFLGFBQXJCLENBQW9DTyxJQUFwQyxFQUNGUSxLQURFLENBQ0lDLEdBQUcsRUFBSSxrREFDVnBCLEdBQUcsQ0FBQ3FCLEdBQUosQ0FBUUMsS0FBUixDQUFjRixHQUFkLEVBQ0gsQ0FIRSxFQUlGRyxPQUpFLENBSU0sSUFBTSxrREFDWHRCLEdBQUcsQ0FBQ2UsUUFBSixDQUFhQSxRQUFiLEVBQ0gsQ0FORSxDQUFQLENBT0gsQ0F6QkQsQyx5QkEyQkEsS0FBTUYsT0FBTSxDQUFHLENBQUNkLEdBQUQsQ0FBTUMsR0FBTixHQUFjLHlCQUN6QixLQUFNVSxLQUFJLDJCQUFHWCxHQUFHLENBQUNHLE9BQUosQ0FBWVEsSUFBZixDQUFWLENBQ0E7QUFGeUIseUJBR3pCLEdBQUksRUFBRSxVQUFZQSxLQUFkLENBQUosQ0FBeUIscURBQ3JCLE1BQU9aLFVBQVMsQ0FBQ0MsR0FBRCxDQUFNQyxHQUFOLENBQWhCLENBQ0gsQ0FGRCxpQ0FIeUIseUJBT3pCQSxHQUFHLENBQUNlLFFBQUosQ0FBYSw0QkFBQWhCLEdBQUcsQ0FBQ0csT0FBSixDQUFZYyxTQUFaLCtCQUF5QixVQUF6QixDQUFiLEVBQ0gsQ0FSRCxDLHlCQVVBTyxNQUFNLENBQUNDLE9BQVAsQ0FBaUJYLE1BQWpCIn0=