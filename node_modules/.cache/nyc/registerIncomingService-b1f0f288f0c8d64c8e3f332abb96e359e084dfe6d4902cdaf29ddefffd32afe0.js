'use strict';function cov_oxt3nwjcs(){var path="/Users/bradleywadsworth/development/reform/pcq-frontend/app/registerIncomingService.js";var hash="f3ff8af6fa41e9d6d36175af927bcf171fd218bc";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/bradleywadsworth/development/reform/pcq-frontend/app/registerIncomingService.js",statementMap:{"0":{start:{line:3,column:15},end:{line:3,column:42}},"1":{start:{line:4,column:46},end:{line:4,column:95}},"2":{start:{line:5,column:20},end:{line:5,column:57}},"3":{start:{line:6,column:19},end:{line:6,column:55}},"4":{start:{line:7,column:15},end:{line:7,column:32}},"5":{start:{line:8,column:19},end:{line:8,column:50}},"6":{start:{line:9,column:19},end:{line:9,column:35}},"7":{start:{line:10,column:15},end:{line:10,column:55}},"8":{start:{line:12,column:0},end:{line:39,column:3}},"9":{start:{line:14,column:4},end:{line:17,column:7}},"10":{start:{line:15,column:8},end:{line:15,column:30}},"11":{start:{line:16,column:8},end:{line:16,column:24}},"12":{start:{line:19,column:24},end:{line:21,column:5}},"13":{start:{line:20,column:8},end:{line:20,column:55}},"14":{start:{line:23,column:4},end:{line:38,column:11}},"15":{start:{line:24,column:63},end:{line:24,column:78}},"16":{start:{line:26,column:12},end:{line:33,column:13}},"17":{start:{line:27,column:16},end:{line:27,column:45}},"18":{start:{line:28,column:16},end:{line:28,column:43}},"19":{start:{line:30,column:16},end:{line:30,column:44}},"20":{start:{line:32,column:16},end:{line:32,column:30}},"21":{start:{line:36,column:12},end:{line:36,column:63}},"22":{start:{line:37,column:12},end:{line:37,column:26}},"23":{start:{line:41,column:0},end:{line:41,column:24}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:12,column:32},end:{line:12,column:33}},loc:{start:{line:12,column:46},end:{line:39,column:1}},line:12},"1":{name:"(anonymous_1)",decl:{start:{line:14,column:27},end:{line:14,column:28}},loc:{start:{line:14,column:33},end:{line:17,column:5}},line:14},"2":{name:"(anonymous_2)",decl:{start:{line:19,column:24},end:{line:19,column:25}},loc:{start:{line:19,column:30},end:{line:21,column:5}},line:19},"3":{name:"(anonymous_3)",decl:{start:{line:24,column:51},end:{line:24,column:52}},loc:{start:{line:24,column:63},end:{line:24,column:78}},line:24},"4":{name:"(anonymous_4)",decl:{start:{line:25,column:14},end:{line:25,column:15}},loc:{start:{line:25,column:28},end:{line:34,column:9}},line:25},"5":{name:"(anonymous_5)",decl:{start:{line:35,column:15},end:{line:35,column:16}},loc:{start:{line:35,column:22},end:{line:38,column:9}},line:35}},branchMap:{"0":{loc:{start:{line:26,column:12},end:{line:33,column:13}},type:"if",locations:[{start:{line:26,column:12},end:{line:33,column:13}},{start:{line:26,column:12},end:{line:33,column:13}}],line:26},"1":{loc:{start:{line:26,column:16},end:{line:26,column:126}},type:"binary-expr",locations:[{start:{line:26,column:17},end:{line:26,column:36}},{start:{line:26,column:40},end:{line:26,column:75}},{start:{line:26,column:80},end:{line:26,column:126}}],line:26}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},b:{"0":[0,0],"1":[0,0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"f3ff8af6fa41e9d6d36175af927bcf171fd218bc"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_oxt3nwjcs=function(){return actualCoverage;};}return actualCoverage;}cov_oxt3nwjcs();const router=(cov_oxt3nwjcs().s[0]++,require('express').Router());const{registerIncomingService,setSession}=(cov_oxt3nwjcs().s[1]++,require('app/middleware/registerIncomingService'));const initSession=(cov_oxt3nwjcs().s[2]++,require('app/middleware/initSession'));const setJourney=(cov_oxt3nwjcs().s[3]++,require('app/middleware/setJourney'));const config=(cov_oxt3nwjcs().s[4]++,require('config'));const AsyncFetch=(cov_oxt3nwjcs().s[5]++,require('app/utils/AsyncFetch'));const asyncFetch=(cov_oxt3nwjcs().s[6]++,new AsyncFetch());const logger=(cov_oxt3nwjcs().s[7]++,require('app/components/logger')('Init'));cov_oxt3nwjcs().s[8]++;router.get('/service-endpoint',(req,res)=>{cov_oxt3nwjcs().f[0]++;cov_oxt3nwjcs().s[9]++;// Reset the session on registering a new incoming service
req.session.regenerate(()=>{cov_oxt3nwjcs().f[1]++;cov_oxt3nwjcs().s[10]++;initSession(req,res);cov_oxt3nwjcs().s[11]++;setSession(req);});cov_oxt3nwjcs().s[12]++;const serviceDown=()=>{cov_oxt3nwjcs().f[2]++;cov_oxt3nwjcs().s[13]++;res.redirect(`${config.app.basePath}/offline`);};cov_oxt3nwjcs().s[14]++;asyncFetch.fetch('http://localhost:4000/health',{},fetchRes=>{cov_oxt3nwjcs().f[3]++;cov_oxt3nwjcs().s[15]++;return fetchRes.json();}).then(async json=>{cov_oxt3nwjcs().f[4]++;cov_oxt3nwjcs().s[16]++;if((cov_oxt3nwjcs().b[1][0]++,json['pcq-backend'])&&(cov_oxt3nwjcs().b[1][1]++,json['pcq-backend'].status==='UP')||(cov_oxt3nwjcs().b[1][2]++,config.services.pcqBackend.enabled==='false')){cov_oxt3nwjcs().b[0][0]++;cov_oxt3nwjcs().s[17]++;registerIncomingService(req);cov_oxt3nwjcs().s[18]++;await setJourney(req,res);cov_oxt3nwjcs().s[19]++;res.redirect('/start-page');}else{cov_oxt3nwjcs().b[0][1]++;cov_oxt3nwjcs().s[20]++;serviceDown();}}).catch(err=>{cov_oxt3nwjcs().f[5]++;cov_oxt3nwjcs().s[21]++;logger.error('Error retrieving app heath: '+err);cov_oxt3nwjcs().s[22]++;serviceDown();});});cov_oxt3nwjcs().s[23]++;module.exports=router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyb3V0ZXIiLCJyZXF1aXJlIiwiUm91dGVyIiwicmVnaXN0ZXJJbmNvbWluZ1NlcnZpY2UiLCJzZXRTZXNzaW9uIiwiaW5pdFNlc3Npb24iLCJzZXRKb3VybmV5IiwiY29uZmlnIiwiQXN5bmNGZXRjaCIsImFzeW5jRmV0Y2giLCJsb2dnZXIiLCJnZXQiLCJyZXEiLCJyZXMiLCJzZXNzaW9uIiwicmVnZW5lcmF0ZSIsInNlcnZpY2VEb3duIiwicmVkaXJlY3QiLCJhcHAiLCJiYXNlUGF0aCIsImZldGNoIiwiZmV0Y2hSZXMiLCJqc29uIiwidGhlbiIsInN0YXR1cyIsInNlcnZpY2VzIiwicGNxQmFja2VuZCIsImVuYWJsZWQiLCJjYXRjaCIsImVyciIsImVycm9yIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInJlZ2lzdGVySW5jb21pbmdTZXJ2aWNlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3Qgcm91dGVyID0gcmVxdWlyZSgnZXhwcmVzcycpLlJvdXRlcigpO1xuY29uc3Qge3JlZ2lzdGVySW5jb21pbmdTZXJ2aWNlLCBzZXRTZXNzaW9ufSA9IHJlcXVpcmUoJ2FwcC9taWRkbGV3YXJlL3JlZ2lzdGVySW5jb21pbmdTZXJ2aWNlJyk7XG5jb25zdCBpbml0U2Vzc2lvbiA9IHJlcXVpcmUoJ2FwcC9taWRkbGV3YXJlL2luaXRTZXNzaW9uJyk7XG5jb25zdCBzZXRKb3VybmV5ID0gcmVxdWlyZSgnYXBwL21pZGRsZXdhcmUvc2V0Sm91cm5leScpO1xuY29uc3QgY29uZmlnID0gcmVxdWlyZSgnY29uZmlnJyk7XG5jb25zdCBBc3luY0ZldGNoID0gcmVxdWlyZSgnYXBwL3V0aWxzL0FzeW5jRmV0Y2gnKTtcbmNvbnN0IGFzeW5jRmV0Y2ggPSBuZXcgQXN5bmNGZXRjaCgpO1xuY29uc3QgbG9nZ2VyID0gcmVxdWlyZSgnYXBwL2NvbXBvbmVudHMvbG9nZ2VyJykoJ0luaXQnKTtcblxucm91dGVyLmdldCgnL3NlcnZpY2UtZW5kcG9pbnQnLCAocmVxLCByZXMpID0+IHtcbiAgICAvLyBSZXNldCB0aGUgc2Vzc2lvbiBvbiByZWdpc3RlcmluZyBhIG5ldyBpbmNvbWluZyBzZXJ2aWNlXG4gICAgcmVxLnNlc3Npb24ucmVnZW5lcmF0ZSgoKSA9PiB7XG4gICAgICAgIGluaXRTZXNzaW9uKHJlcSwgcmVzKTtcbiAgICAgICAgc2V0U2Vzc2lvbihyZXEpO1xuICAgIH0pO1xuXG4gICAgY29uc3Qgc2VydmljZURvd24gPSAoKSA9PiB7XG4gICAgICAgIHJlcy5yZWRpcmVjdChgJHtjb25maWcuYXBwLmJhc2VQYXRofS9vZmZsaW5lYCk7XG4gICAgfTtcblxuICAgIGFzeW5jRmV0Y2hcbiAgICAgICAgLmZldGNoKCdodHRwOi8vbG9jYWxob3N0OjQwMDAvaGVhbHRoJywge30sIGZldGNoUmVzID0+IGZldGNoUmVzLmpzb24oKSlcbiAgICAgICAgLnRoZW4oYXN5bmMganNvbiA9PiB7XG4gICAgICAgICAgICBpZiAoKGpzb25bJ3BjcS1iYWNrZW5kJ10gJiYganNvblsncGNxLWJhY2tlbmQnXS5zdGF0dXMgPT09ICdVUCcpIHx8IGNvbmZpZy5zZXJ2aWNlcy5wY3FCYWNrZW5kLmVuYWJsZWQgPT09ICdmYWxzZScpIHtcbiAgICAgICAgICAgICAgICByZWdpc3RlckluY29taW5nU2VydmljZShyZXEpO1xuICAgICAgICAgICAgICAgIGF3YWl0IHNldEpvdXJuZXkocmVxLCByZXMpO1xuXG4gICAgICAgICAgICAgICAgcmVzLnJlZGlyZWN0KCcvc3RhcnQtcGFnZScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZXJ2aWNlRG93bigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgcmV0cmlldmluZyBhcHAgaGVhdGg6ICcgKyBlcnIpO1xuICAgICAgICAgICAgc2VydmljZURvd24oKTtcbiAgICAgICAgfSk7XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7XG4iXSwibWFwcGluZ3MiOiJBQUFBLGEsNjlHQWVZO3lGQWJaLEtBQU1BLE9BQU0seUJBQUdDLE9BQU8sQ0FBQyxTQUFELENBQVAsQ0FBbUJDLE1BQW5CLEVBQUgsQ0FBWixDQUNBLEtBQU0sQ0FBQ0MsdUJBQUQsQ0FBMEJDLFVBQTFCLDBCQUF3Q0gsT0FBTyxDQUFDLHdDQUFELENBQS9DLENBQU4sQ0FDQSxLQUFNSSxZQUFXLHlCQUFHSixPQUFPLENBQUMsNEJBQUQsQ0FBVixDQUFqQixDQUNBLEtBQU1LLFdBQVUseUJBQUdMLE9BQU8sQ0FBQywyQkFBRCxDQUFWLENBQWhCLENBQ0EsS0FBTU0sT0FBTSx5QkFBR04sT0FBTyxDQUFDLFFBQUQsQ0FBVixDQUFaLENBQ0EsS0FBTU8sV0FBVSx5QkFBR1AsT0FBTyxDQUFDLHNCQUFELENBQVYsQ0FBaEIsQ0FDQSxLQUFNUSxXQUFVLHlCQUFHLEdBQUlELFdBQUosRUFBSCxDQUFoQixDQUNBLEtBQU1FLE9BQU0seUJBQUdULE9BQU8sQ0FBQyx1QkFBRCxDQUFQLENBQWlDLE1BQWpDLENBQUgsQ0FBWixDLHVCQUVBRCxNQUFNLENBQUNXLEdBQVAsQ0FBVyxtQkFBWCxDQUFnQyxDQUFDQyxHQUFELENBQU1DLEdBQU4sR0FBYywrQ0FDMUM7QUFDQUQsR0FBRyxDQUFDRSxPQUFKLENBQVlDLFVBQVosQ0FBdUIsSUFBTSxnREFDekJWLFdBQVcsQ0FBQ08sR0FBRCxDQUFNQyxHQUFOLENBQVgsQ0FEeUIsd0JBRXpCVCxVQUFVLENBQUNRLEdBQUQsQ0FBVixDQUNILENBSEQsRUFGMEMsd0JBTzFDLEtBQU1JLFlBQVcsQ0FBRyxJQUFNLGdEQUN0QkgsR0FBRyxDQUFDSSxRQUFKLENBQWMsR0FBRVYsTUFBTSxDQUFDVyxHQUFQLENBQVdDLFFBQVMsVUFBcEMsRUFDSCxDQUZELENBUDBDLHdCQVcxQ1YsVUFBVSxDQUNMVyxLQURMLENBQ1csOEJBRFgsQ0FDMkMsRUFEM0MsQ0FDK0NDLFFBQVEsRUFBSSxzREFBQUEsU0FBUSxDQUFDQyxJQUFULEdBQWUsQ0FEMUUsRUFFS0MsSUFGTCxDQUVVLEtBQU1ELEtBQU4sRUFBYyxnREFDaEIsR0FBSywyQkFBQUEsSUFBSSxDQUFDLGFBQUQsQ0FBSiw4QkFBdUJBLElBQUksQ0FBQyxhQUFELENBQUosQ0FBb0JFLE1BQXBCLEdBQStCLElBQXRELENBQUQsNkJBQWdFakIsTUFBTSxDQUFDa0IsUUFBUCxDQUFnQkMsVUFBaEIsQ0FBMkJDLE9BQTNCLEdBQXVDLE9BQXZHLENBQUosQ0FBb0gsbURBQ2hIeEIsdUJBQXVCLENBQUNTLEdBQUQsQ0FBdkIsQ0FEZ0gsd0JBRWhILEtBQU1OLFdBQVUsQ0FBQ00sR0FBRCxDQUFNQyxHQUFOLENBQWhCLENBRmdILHdCQUloSEEsR0FBRyxDQUFDSSxRQUFKLENBQWEsYUFBYixFQUNILENBTEQsSUFLTyxtREFDSEQsV0FBVyxHQUNkLENBQ0osQ0FYTCxFQVlLWSxLQVpMLENBWVdDLEdBQUcsRUFBSSxnREFDVm5CLE1BQU0sQ0FBQ29CLEtBQVAsQ0FBYSwrQkFBaUNELEdBQTlDLEVBRFUsd0JBRVZiLFdBQVcsR0FDZCxDQWZMLEVBZ0JILENBM0JELEUsd0JBNkJBZSxNQUFNLENBQUNDLE9BQVAsQ0FBaUJoQyxNQUFqQiJ9