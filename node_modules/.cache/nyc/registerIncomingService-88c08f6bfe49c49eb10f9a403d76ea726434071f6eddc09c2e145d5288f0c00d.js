'use strict';function cov_277z9n5xza(){var path="/Users/bradleywadsworth/development/reform/pcq-frontend/app/middleware/registerIncomingService.js";var hash="18a0dc3270c38be9b688f582eecb7dfce87860d5";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/bradleywadsworth/development/reform/pcq-frontend/app/middleware/registerIncomingService.js",statementMap:{"0":{start:{line:3,column:15},end:{line:3,column:55}},"1":{start:{line:4,column:13},end:{line:4,column:43}},"2":{start:{line:5,column:20},end:{line:5,column:57}},"3":{start:{line:6,column:27},end:{line:6,column:60}},"4":{start:{line:7,column:22},end:{line:7,column:64}},"5":{start:{line:10,column:22},end:{line:18,column:1}},"6":{start:{line:20,column:19},end:{line:50,column:1}},"7":{start:{line:21,column:20},end:{line:21,column:31}},"8":{start:{line:22,column:17},end:{line:22,column:29}},"9":{start:{line:24,column:4},end:{line:47,column:7}},"10":{start:{line:25,column:22},end:{line:25,column:43}},"11":{start:{line:26,column:8},end:{line:46,column:9}},"12":{start:{line:27,column:12},end:{line:45,column:13}},"13":{start:{line:30,column:20},end:{line:30,column:95}},"14":{start:{line:31,column:20},end:{line:31,column:26}},"15":{start:{line:35,column:20},end:{line:35,column:45}},"16":{start:{line:36,column:20},end:{line:36,column:26}},"17":{start:{line:38,column:20},end:{line:38,column:73}},"18":{start:{line:39,column:20},end:{line:39,column:26}},"19":{start:{line:41,column:20},end:{line:41,column:48}},"20":{start:{line:42,column:20},end:{line:42,column:26}},"21":{start:{line:44,column:20},end:{line:44,column:26}},"22":{start:{line:49,column:4},end:{line:49,column:61}},"23":{start:{line:52,column:27},end:{line:72,column:1}},"24":{start:{line:53,column:34},end:{line:53,column:36}},"25":{start:{line:55,column:4},end:{line:60,column:7}},"26":{start:{line:57,column:8},end:{line:59,column:9}},"27":{start:{line:58,column:12},end:{line:58,column:51}},"28":{start:{line:62,column:4},end:{line:71,column:5}},"29":{start:{line:63,column:8},end:{line:63,column:89}},"30":{start:{line:64,column:11},end:{line:71,column:5}},"31":{start:{line:65,column:8},end:{line:65,column:82}},"32":{start:{line:67,column:8},end:{line:67,column:57}},"33":{start:{line:68,column:8},end:{line:68,column:43}},"34":{start:{line:70,column:8},end:{line:70,column:56}},"35":{start:{line:74,column:25},end:{line:77,column:1}},"36":{start:{line:75,column:4},end:{line:76,column:98}},"37":{start:{line:76,column:36},end:{line:76,column:61}},"38":{start:{line:79,column:32},end:{line:89,column:1}},"39":{start:{line:80,column:4},end:{line:80,column:27}},"40":{start:{line:81,column:20},end:{line:81,column:37}},"41":{start:{line:82,column:4},end:{line:85,column:5}},"42":{start:{line:83,column:31},end:{line:83,column:65}},"43":{start:{line:84,column:8},end:{line:84,column:43}},"44":{start:{line:86,column:4},end:{line:88,column:5}},"45":{start:{line:87,column:8},end:{line:87,column:32}},"46":{start:{line:91,column:0},end:{line:94,column:2}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:20,column:19},end:{line:20,column:20}},loc:{start:{line:20,column:26},end:{line:50,column:1}},line:20},"1":{name:"(anonymous_1)",decl:{start:{line:24,column:26},end:{line:24,column:27}},loc:{start:{line:24,column:35},end:{line:47,column:5}},line:24},"2":{name:"(anonymous_2)",decl:{start:{line:52,column:27},end:{line:52,column:28}},loc:{start:{line:52,column:34},end:{line:72,column:1}},line:52},"3":{name:"(anonymous_3)",decl:{start:{line:55,column:26},end:{line:55,column:27}},loc:{start:{line:55,column:35},end:{line:60,column:5}},line:55},"4":{name:"(anonymous_4)",decl:{start:{line:74,column:25},end:{line:74,column:26}},loc:{start:{line:74,column:40},end:{line:77,column:1}},line:74},"5":{name:"(anonymous_5)",decl:{start:{line:76,column:31},end:{line:76,column:32}},loc:{start:{line:76,column:36},end:{line:76,column:61}},line:76},"6":{name:"(anonymous_6)",decl:{start:{line:79,column:32},end:{line:79,column:33}},loc:{start:{line:79,column:41},end:{line:89,column:1}},line:79}},branchMap:{"0":{loc:{start:{line:26,column:8},end:{line:46,column:9}},type:"if",locations:[{start:{line:26,column:8},end:{line:46,column:9}},{start:{line:26,column:8},end:{line:46,column:9}}],line:26},"1":{loc:{start:{line:27,column:12},end:{line:45,column:13}},type:"switch",locations:[{start:{line:28,column:16},end:{line:28,column:33}},{start:{line:29,column:16},end:{line:31,column:26}},{start:{line:32,column:16},end:{line:32,column:29}},{start:{line:33,column:16},end:{line:33,column:33}},{start:{line:34,column:16},end:{line:36,column:26}},{start:{line:37,column:16},end:{line:39,column:26}},{start:{line:40,column:16},end:{line:42,column:26}},{start:{line:43,column:16},end:{line:44,column:26}}],line:27},"2":{loc:{start:{line:30,column:39},end:{line:30,column:94}},type:"cond-expr",locations:[{start:{line:30,column:67},end:{line:30,column:86}},{start:{line:30,column:89},end:{line:30,column:94}}],line:30},"3":{loc:{start:{line:49,column:19},end:{line:49,column:60}},type:"cond-expr",locations:[{start:{line:49,column:39},end:{line:49,column:56}},{start:{line:49,column:59},end:{line:49,column:60}}],line:49},"4":{loc:{start:{line:57,column:8},end:{line:59,column:9}},type:"if",locations:[{start:{line:57,column:8},end:{line:59,column:9}},{start:{line:57,column:8},end:{line:59,column:9}}],line:57},"5":{loc:{start:{line:57,column:12},end:{line:57,column:52}},type:"binary-expr",locations:[{start:{line:57,column:12},end:{line:57,column:26}},{start:{line:57,column:30},end:{line:57,column:52}}],line:57},"6":{loc:{start:{line:62,column:4},end:{line:71,column:5}},type:"if",locations:[{start:{line:62,column:4},end:{line:71,column:5}},{start:{line:62,column:4},end:{line:71,column:5}}],line:62},"7":{loc:{start:{line:64,column:11},end:{line:71,column:5}},type:"if",locations:[{start:{line:64,column:11},end:{line:71,column:5}},{start:{line:64,column:11},end:{line:71,column:5}}],line:64},"8":{loc:{start:{line:75,column:19},end:{line:76,column:96}},type:"binary-expr",locations:[{start:{line:75,column:19},end:{line:75,column:28}},{start:{line:76,column:8},end:{line:76,column:96}}],line:75},"9":{loc:{start:{line:82,column:4},end:{line:85,column:5}},type:"if",locations:[{start:{line:82,column:4},end:{line:85,column:5}},{start:{line:82,column:4},end:{line:85,column:5}}],line:82},"10":{loc:{start:{line:86,column:4},end:{line:88,column:5}},type:"if",locations:[{start:{line:86,column:4},end:{line:88,column:5}},{start:{line:86,column:4},end:{line:88,column:5}}],line:86}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},b:{"0":[0,0],"1":[0,0,0,0,0,0,0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"18a0dc3270c38be9b688f582eecb7dfce87860d5"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_277z9n5xza=function(){return actualCoverage;};}return actualCoverage;}cov_277z9n5xza();const logger=(cov_277z9n5xza().s[0]++,require('app/components/logger')('Init'));const auth=(cov_277z9n5xza().s[1]++,require('app/components/auth'));const stringUtils=(cov_277z9n5xza().s[2]++,require('../components/string-utils'));const registeredServices=(cov_277z9n5xza().s[3]++,require('app/registeredServices'));const{verifyToken}=(cov_277z9n5xza().s[4]++,require('app/components/encryption-token'));// This excludes the token as this is handled separately
const pcqParameters=(cov_277z9n5xza().s[5]++,[{name:'serviceId',required:true},{name:'actor',required:true},{name:'pcqId',required:true},{name:'ccdCaseId',required:false},{name:'partyId',required:true},{name:'returnUrl',required:true},{name:'language',required:false}]);cov_277z9n5xza().s[6]++;const setSession=req=>{cov_277z9n5xza().f[0]++;const session=(cov_277z9n5xza().s[7]++,req.session);const form=(cov_277z9n5xza().s[8]++,session.form);cov_277z9n5xza().s[9]++;pcqParameters.forEach(param=>{cov_277z9n5xza().f[1]++;const value=(cov_277z9n5xza().s[10]++,req.query[param.name]);cov_277z9n5xza().s[11]++;if(value){cov_277z9n5xza().b[0][0]++;cov_277z9n5xza().s[12]++;switch(param.name){case'serviceId':cov_277z9n5xza().b[1][0]++;case'actor':cov_277z9n5xza().b[1][1]++;cov_277z9n5xza().s[13]++;form[param.name]=typeof value==='string'?(cov_277z9n5xza().b[2][0]++,value.toLowerCase()):(cov_277z9n5xza().b[2][1]++,value);cov_277z9n5xza().s[14]++;break;case'pcqId':cov_277z9n5xza().b[1][2]++;case'ccdCaseId':cov_277z9n5xza().b[1][3]++;case'partyId':cov_277z9n5xza().b[1][4]++;cov_277z9n5xza().s[15]++;form[param.name]=value;cov_277z9n5xza().s[16]++;break;case'returnUrl':cov_277z9n5xza().b[1][5]++;cov_277z9n5xza().s[17]++;session[param.name]=stringUtils.prefixHttps(value);cov_277z9n5xza().s[18]++;break;case'language':cov_277z9n5xza().b[1][6]++;cov_277z9n5xza().s[19]++;session[param.name]=value;cov_277z9n5xza().s[20]++;break;default:cov_277z9n5xza().b[1][7]++;cov_277z9n5xza().s[21]++;break;}}else{cov_277z9n5xza().b[0][1]++;}});cov_277z9n5xza().s[22]++;form.channel=req.query.channel?(cov_277z9n5xza().b[3][0]++,req.query.channel):(cov_277z9n5xza().b[3][1]++,1);};cov_277z9n5xza().s[23]++;const validateParameters=req=>{cov_277z9n5xza().f[2]++;const missingRequiredParams=(cov_277z9n5xza().s[24]++,[]);cov_277z9n5xza().s[25]++;pcqParameters.forEach(param=>{cov_277z9n5xza().f[3]++;cov_277z9n5xza().s[26]++;// If a required parameter is missing
if((cov_277z9n5xza().b[5][0]++,param.required)&&(cov_277z9n5xza().b[5][1]++,!req.query[param.name])){cov_277z9n5xza().b[4][0]++;cov_277z9n5xza().s[27]++;missingRequiredParams.push(param.name);}else{cov_277z9n5xza().b[4][1]++;}});cov_277z9n5xza().s[28]++;if(missingRequiredParams.length>0){cov_277z9n5xza().b[6][0]++;cov_277z9n5xza().s[29]++;logger.error('Missing required parameters: '+missingRequiredParams.join(', '));}else{cov_277z9n5xza().b[6][1]++;cov_277z9n5xza().s[30]++;if(!validatedService(req.query.serviceId)){cov_277z9n5xza().b[7][0]++;cov_277z9n5xza().s[31]++;logger.error(`Service ${req.query.serviceId} is not registered with PCQ`);}else{cov_277z9n5xza().b[7][1]++;cov_277z9n5xza().s[32]++;logger.info('Parameters verified successfully.');cov_277z9n5xza().s[33]++;req.session.validParameters=true;// Create the JWT Token after the required parameters have been set.
cov_277z9n5xza().s[34]++;auth.createToken(req,req.session.form.partyId);}}};cov_277z9n5xza().s[35]++;const validatedService=serviceId=>{cov_277z9n5xza().f[4]++;cov_277z9n5xza().s[36]++;return Boolean((cov_277z9n5xza().b[8][0]++,serviceId)&&(cov_277z9n5xza().b[8][1]++,registeredServices.map(s=>{cov_277z9n5xza().f[5]++;cov_277z9n5xza().s[37]++;return s.serviceId.toLowerCase();}).includes(serviceId.toLowerCase())));};cov_277z9n5xza().s[38]++;const registerIncomingService=req=>{cov_277z9n5xza().f[6]++;cov_277z9n5xza().s[39]++;logger.info(req.query);const partyId=(cov_277z9n5xza().s[40]++,req.query.partyId);cov_277z9n5xza().s[41]++;if(partyId){cov_277z9n5xza().b[9][0]++;const changedPartyId=(cov_277z9n5xza().s[42]++,partyId.trim().replace(/\s/g,'+'));cov_277z9n5xza().s[43]++;req.query.partyId=changedPartyId;}else{cov_277z9n5xza().b[9][1]++;}cov_277z9n5xza().s[44]++;if(verifyToken(req.query)){cov_277z9n5xza().b[10][0]++;cov_277z9n5xza().s[45]++;validateParameters(req);}else{cov_277z9n5xza().b[10][1]++;}};cov_277z9n5xza().s[46]++;module.exports={registerIncomingService,setSession};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJsb2dnZXIiLCJyZXF1aXJlIiwiYXV0aCIsInN0cmluZ1V0aWxzIiwicmVnaXN0ZXJlZFNlcnZpY2VzIiwidmVyaWZ5VG9rZW4iLCJwY3FQYXJhbWV0ZXJzIiwibmFtZSIsInJlcXVpcmVkIiwic2V0U2Vzc2lvbiIsInJlcSIsInNlc3Npb24iLCJmb3JtIiwiZm9yRWFjaCIsInBhcmFtIiwidmFsdWUiLCJxdWVyeSIsInRvTG93ZXJDYXNlIiwicHJlZml4SHR0cHMiLCJjaGFubmVsIiwidmFsaWRhdGVQYXJhbWV0ZXJzIiwibWlzc2luZ1JlcXVpcmVkUGFyYW1zIiwicHVzaCIsImxlbmd0aCIsImVycm9yIiwiam9pbiIsInZhbGlkYXRlZFNlcnZpY2UiLCJzZXJ2aWNlSWQiLCJpbmZvIiwidmFsaWRQYXJhbWV0ZXJzIiwiY3JlYXRlVG9rZW4iLCJwYXJ0eUlkIiwiQm9vbGVhbiIsIm1hcCIsInMiLCJpbmNsdWRlcyIsInJlZ2lzdGVySW5jb21pbmdTZXJ2aWNlIiwiY2hhbmdlZFBhcnR5SWQiLCJ0cmltIiwicmVwbGFjZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJyZWdpc3RlckluY29taW5nU2VydmljZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IGxvZ2dlciA9IHJlcXVpcmUoJ2FwcC9jb21wb25lbnRzL2xvZ2dlcicpKCdJbml0Jyk7XG5jb25zdCBhdXRoID0gcmVxdWlyZSgnYXBwL2NvbXBvbmVudHMvYXV0aCcpO1xuY29uc3Qgc3RyaW5nVXRpbHMgPSByZXF1aXJlKCcuLi9jb21wb25lbnRzL3N0cmluZy11dGlscycpO1xuY29uc3QgcmVnaXN0ZXJlZFNlcnZpY2VzID0gcmVxdWlyZSgnYXBwL3JlZ2lzdGVyZWRTZXJ2aWNlcycpO1xuY29uc3Qge3ZlcmlmeVRva2VufSA9IHJlcXVpcmUoJ2FwcC9jb21wb25lbnRzL2VuY3J5cHRpb24tdG9rZW4nKTtcblxuLy8gVGhpcyBleGNsdWRlcyB0aGUgdG9rZW4gYXMgdGhpcyBpcyBoYW5kbGVkIHNlcGFyYXRlbHlcbmNvbnN0IHBjcVBhcmFtZXRlcnMgPSBbXG4gICAge25hbWU6ICdzZXJ2aWNlSWQnLCByZXF1aXJlZDogdHJ1ZX0sXG4gICAge25hbWU6ICdhY3RvcicsIHJlcXVpcmVkOiB0cnVlfSxcbiAgICB7bmFtZTogJ3BjcUlkJywgcmVxdWlyZWQ6IHRydWV9LFxuICAgIHtuYW1lOiAnY2NkQ2FzZUlkJywgcmVxdWlyZWQ6IGZhbHNlfSxcbiAgICB7bmFtZTogJ3BhcnR5SWQnLCByZXF1aXJlZDogdHJ1ZX0sXG4gICAge25hbWU6ICdyZXR1cm5VcmwnLCByZXF1aXJlZDogdHJ1ZX0sXG4gICAge25hbWU6ICdsYW5ndWFnZScsIHJlcXVpcmVkOiBmYWxzZX1cbl07XG5cbmNvbnN0IHNldFNlc3Npb24gPSByZXEgPT4ge1xuICAgIGNvbnN0IHNlc3Npb24gPSByZXEuc2Vzc2lvbjtcbiAgICBjb25zdCBmb3JtID0gc2Vzc2lvbi5mb3JtO1xuXG4gICAgcGNxUGFyYW1ldGVycy5mb3JFYWNoKHBhcmFtID0+IHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSByZXEucXVlcnlbcGFyYW0ubmFtZV07XG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgc3dpdGNoIChwYXJhbS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc2VydmljZUlkJzpcbiAgICAgICAgICAgICAgICBjYXNlICdhY3Rvcic6XG4gICAgICAgICAgICAgICAgICAgIGZvcm1bcGFyYW0ubmFtZV0gPSB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnID8gdmFsdWUudG9Mb3dlckNhc2UoKSA6IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdwY3FJZCc6XG4gICAgICAgICAgICAgICAgY2FzZSAnY2NkQ2FzZUlkJzpcbiAgICAgICAgICAgICAgICBjYXNlICdwYXJ0eUlkJzpcbiAgICAgICAgICAgICAgICAgICAgZm9ybVtwYXJhbS5uYW1lXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdyZXR1cm5VcmwnOlxuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uW3BhcmFtLm5hbWVdID0gc3RyaW5nVXRpbHMucHJlZml4SHR0cHModmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdsYW5ndWFnZSc6XG4gICAgICAgICAgICAgICAgICAgIHNlc3Npb25bcGFyYW0ubmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGZvcm0uY2hhbm5lbCA9IHJlcS5xdWVyeS5jaGFubmVsID8gcmVxLnF1ZXJ5LmNoYW5uZWwgOiAxO1xufTtcblxuY29uc3QgdmFsaWRhdGVQYXJhbWV0ZXJzID0gcmVxID0+IHtcbiAgICBjb25zdCBtaXNzaW5nUmVxdWlyZWRQYXJhbXMgPSBbXTtcblxuICAgIHBjcVBhcmFtZXRlcnMuZm9yRWFjaChwYXJhbSA9PiB7XG4gICAgICAgIC8vIElmIGEgcmVxdWlyZWQgcGFyYW1ldGVyIGlzIG1pc3NpbmdcbiAgICAgICAgaWYgKHBhcmFtLnJlcXVpcmVkICYmICFyZXEucXVlcnlbcGFyYW0ubmFtZV0pIHtcbiAgICAgICAgICAgIG1pc3NpbmdSZXF1aXJlZFBhcmFtcy5wdXNoKHBhcmFtLm5hbWUpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAobWlzc2luZ1JlcXVpcmVkUGFyYW1zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdNaXNzaW5nIHJlcXVpcmVkIHBhcmFtZXRlcnM6ICcgKyBtaXNzaW5nUmVxdWlyZWRQYXJhbXMuam9pbignLCAnKSk7XG4gICAgfSBlbHNlIGlmICghdmFsaWRhdGVkU2VydmljZShyZXEucXVlcnkuc2VydmljZUlkKSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoYFNlcnZpY2UgJHtyZXEucXVlcnkuc2VydmljZUlkfSBpcyBub3QgcmVnaXN0ZXJlZCB3aXRoIFBDUWApO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZ2dlci5pbmZvKCdQYXJhbWV0ZXJzIHZlcmlmaWVkIHN1Y2Nlc3NmdWxseS4nKTtcbiAgICAgICAgcmVxLnNlc3Npb24udmFsaWRQYXJhbWV0ZXJzID0gdHJ1ZTtcbiAgICAgICAgLy8gQ3JlYXRlIHRoZSBKV1QgVG9rZW4gYWZ0ZXIgdGhlIHJlcXVpcmVkIHBhcmFtZXRlcnMgaGF2ZSBiZWVuIHNldC5cbiAgICAgICAgYXV0aC5jcmVhdGVUb2tlbihyZXEsIHJlcS5zZXNzaW9uLmZvcm0ucGFydHlJZCk7XG4gICAgfVxufTtcblxuY29uc3QgdmFsaWRhdGVkU2VydmljZSA9IChzZXJ2aWNlSWQpID0+IHtcbiAgICByZXR1cm4gQm9vbGVhbihzZXJ2aWNlSWQgJiZcbiAgICAgICAgcmVnaXN0ZXJlZFNlcnZpY2VzLm1hcChzID0+IHMuc2VydmljZUlkLnRvTG93ZXJDYXNlKCkpLmluY2x1ZGVzKHNlcnZpY2VJZC50b0xvd2VyQ2FzZSgpKSk7XG59O1xuXG5jb25zdCByZWdpc3RlckluY29taW5nU2VydmljZSA9IChyZXEpID0+IHtcbiAgICBsb2dnZXIuaW5mbyhyZXEucXVlcnkpO1xuICAgIGNvbnN0IHBhcnR5SWQgPSByZXEucXVlcnkucGFydHlJZDtcbiAgICBpZiAocGFydHlJZCkge1xuICAgICAgICBjb25zdCBjaGFuZ2VkUGFydHlJZCA9IHBhcnR5SWQudHJpbSgpLnJlcGxhY2UoL1xccy9nLCAnKycpO1xuICAgICAgICByZXEucXVlcnkucGFydHlJZCA9IGNoYW5nZWRQYXJ0eUlkO1xuICAgIH1cbiAgICBpZiAodmVyaWZ5VG9rZW4ocmVxLnF1ZXJ5KSkge1xuICAgICAgICB2YWxpZGF0ZVBhcmFtZXRlcnMocmVxKTtcbiAgICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgICByZWdpc3RlckluY29taW5nU2VydmljZSxcbiAgICBzZXRTZXNzaW9uXG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQSxhLGdvT0FlWTsyRkFiWixLQUFNQSxPQUFNLDBCQUFHQyxPQUFPLENBQUMsdUJBQUQsQ0FBUCxDQUFpQyxNQUFqQyxDQUFILENBQVosQ0FDQSxLQUFNQyxLQUFJLDBCQUFHRCxPQUFPLENBQUMscUJBQUQsQ0FBVixDQUFWLENBQ0EsS0FBTUUsWUFBVywwQkFBR0YsT0FBTyxDQUFDLDRCQUFELENBQVYsQ0FBakIsQ0FDQSxLQUFNRyxtQkFBa0IsMEJBQUdILE9BQU8sQ0FBQyx3QkFBRCxDQUFWLENBQXhCLENBQ0EsS0FBTSxDQUFDSSxXQUFELDJCQUFnQkosT0FBTyxDQUFDLGlDQUFELENBQXZCLENBQU4sQ0FFQTtBQUNBLEtBQU1LLGNBQWEsMEJBQUcsQ0FDbEIsQ0FBQ0MsSUFBSSxDQUFFLFdBQVAsQ0FBb0JDLFFBQVEsQ0FBRSxJQUE5QixDQURrQixDQUVsQixDQUFDRCxJQUFJLENBQUUsT0FBUCxDQUFnQkMsUUFBUSxDQUFFLElBQTFCLENBRmtCLENBR2xCLENBQUNELElBQUksQ0FBRSxPQUFQLENBQWdCQyxRQUFRLENBQUUsSUFBMUIsQ0FIa0IsQ0FJbEIsQ0FBQ0QsSUFBSSxDQUFFLFdBQVAsQ0FBb0JDLFFBQVEsQ0FBRSxLQUE5QixDQUprQixDQUtsQixDQUFDRCxJQUFJLENBQUUsU0FBUCxDQUFrQkMsUUFBUSxDQUFFLElBQTVCLENBTGtCLENBTWxCLENBQUNELElBQUksQ0FBRSxXQUFQLENBQW9CQyxRQUFRLENBQUUsSUFBOUIsQ0FOa0IsQ0FPbEIsQ0FBQ0QsSUFBSSxDQUFFLFVBQVAsQ0FBbUJDLFFBQVEsQ0FBRSxLQUE3QixDQVBrQixDQUFILENBQW5CLEMsd0JBVUEsS0FBTUMsV0FBVSxDQUFHQyxHQUFHLEVBQUkseUJBQ3RCLEtBQU1DLFFBQU8sMEJBQUdELEdBQUcsQ0FBQ0MsT0FB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