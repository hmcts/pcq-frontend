'use strict';function cov_z6zv9b7aa(){var path="/Users/bradleywadsworth/development/reform/pcq-frontend/app/middleware/setJourney.js";var hash="4e2790af0772b0750c2ca074e5f8a916ae00b7ed";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/bradleywadsworth/development/reform/pcq-frontend/app/middleware/setJourney.js",statementMap:{"0":{start:{line:2,column:22},end:{line:2,column:64}},"1":{start:{line:3,column:15},end:{line:3,column:47}},"2":{start:{line:5,column:23},end:{line:7,column:1}},"3":{start:{line:6,column:4},end:{line:6,column:57}},"4":{start:{line:9,column:19},end:{line:27,column:1}},"5":{start:{line:10,column:24},end:{line:10,column:94}},"6":{start:{line:11,column:18},end:{line:11,column:70}},"7":{start:{line:13,column:4},end:{line:24,column:5}},"8":{start:{line:14,column:24},end:{line:14,column:72}},"9":{start:{line:16,column:8},end:{line:18,column:9}},"10":{start:{line:17,column:12},end:{line:17,column:97}},"11":{start:{line:20,column:8},end:{line:20,column:38}},"12":{start:{line:22,column:8},end:{line:22,column:49}},"13":{start:{line:23,column:8},end:{line:23,column:64}},"14":{start:{line:26,column:4},end:{line:26,column:31}},"15":{start:{line:29,column:32},end:{line:55,column:1}},"16":{start:{line:30,column:21},end:{line:30,column:94}},"17":{start:{line:30,column:48},end:{line:30,column:93}},"18":{start:{line:31,column:4},end:{line:54,column:11}},"19":{start:{line:33,column:29},end:{line:33,column:31}},"20":{start:{line:34,column:12},end:{line:41,column:15}},"21":{start:{line:35,column:16},end:{line:40,column:17}},"22":{start:{line:36,column:20},end:{line:39,column:23}},"23":{start:{line:42,column:12},end:{line:42,column:28}},"24":{start:{line:45,column:12},end:{line:45,column:110}},"25":{start:{line:51,column:12},end:{line:53,column:15}},"26":{start:{line:52,column:16},end:{line:52,column:47}},"27":{start:{line:57,column:0},end:{line:57,column:28}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:5,column:23},end:{line:5,column:24}},loc:{start:{line:5,column:31},end:{line:7,column:1}},line:5},"1":{name:"(anonymous_1)",decl:{start:{line:9,column:19},end:{line:9,column:20}},loc:{start:{line:9,column:39},end:{line:27,column:1}},line:9},"2":{name:"(anonymous_2)",decl:{start:{line:29,column:32},end:{line:29,column:33}},loc:{start:{line:29,column:64},end:{line:55,column:1}},line:29},"3":{name:"(anonymous_3)",decl:{start:{line:30,column:42},end:{line:30,column:43}},loc:{start:{line:30,column:48},end:{line:30,column:93}},line:30},"4":{name:"(anonymous_4)",decl:{start:{line:32,column:14},end:{line:32,column:15}},loc:{start:{line:32,column:24},end:{line:43,column:9}},line:32},"5":{name:"(anonymous_5)",decl:{start:{line:34,column:37},end:{line:34,column:38}},loc:{start:{line:34,column:48},end:{line:41,column:13}},line:34},"6":{name:"(anonymous_6)",decl:{start:{line:44,column:15},end:{line:44,column:16}},loc:{start:{line:44,column:21},end:{line:54,column:9}},line:44},"7":{name:"(anonymous_7)",decl:{start:{line:51,column:40},end:{line:51,column:41}},loc:{start:{line:51,column:46},end:{line:53,column:13}},line:51}},branchMap:{"0":{loc:{start:{line:10,column:24},end:{line:10,column:94}},type:"cond-expr",locations:[{start:{line:10,column:43},end:{line:10,column:82}},{start:{line:10,column:85},end:{line:10,column:94}}],line:10},"1":{loc:{start:{line:10,column:43},end:{line:10,column:82}},type:"binary-expr",locations:[{start:{line:10,column:43},end:{line:10,column:69}},{start:{line:10,column:73},end:{line:10,column:82}}],line:10},"2":{loc:{start:{line:11,column:18},end:{line:11,column:70}},type:"cond-expr",locations:[{start:{line:11,column:37},end:{line:11,column:65}},{start:{line:11,column:68},end:{line:11,column:70}}],line:11},"3":{loc:{start:{line:11,column:37},end:{line:11,column:65}},type:"binary-expr",locations:[{start:{line:11,column:37},end:{line:11,column:59}},{start:{line:11,column:63},end:{line:11,column:65}}],line:11},"4":{loc:{start:{line:16,column:8},end:{line:18,column:9}},type:"if",locations:[{start:{line:16,column:8},end:{line:18,column:9}},{start:{line:16,column:8},end:{line:18,column:9}}],line:16},"5":{loc:{start:{line:35,column:16},end:{line:40,column:17}},type:"if",locations:[{start:{line:35,column:16},end:{line:40,column:17}},{start:{line:35,column:16},end:{line:40,column:17}}],line:35},"6":{loc:{start:{line:38,column:28},end:{line:38,column:78}},type:"binary-expr",locations:[{start:{line:38,column:28},end:{line:38,column:43}},{start:{line:38,column:47},end:{line:38,column:78}}],line:38}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"4e2790af0772b0750c2ca074e5f8a916ae00b7ed"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_z6zv9b7aa=function(){return actualCoverage;};}return actualCoverage;}cov_z6zv9b7aa();const featureToggle=(cov_z6zv9b7aa().s[0]++,new(require('app/utils/FeatureToggle'))());const logger=(cov_z6zv9b7aa().s[1]++,require('app/components/logger'));cov_z6zv9b7aa().s[2]++;const getBaseJourney=name=>{cov_z6zv9b7aa().f[0]++;cov_z6zv9b7aa().s[3]++;return require(`app/journeys/${name.toLowerCase()}`);};cov_z6zv9b7aa().s[4]++;const setJourney=async(req,res)=>{cov_z6zv9b7aa().f[1]++;const journeyName=(cov_z6zv9b7aa().s[5]++,req.session.form?(cov_z6zv9b7aa().b[0][0]++,(cov_z6zv9b7aa().b[1][0]++,req.session.form.serviceId)||(cov_z6zv9b7aa().b[1][1]++,'DEFAULT')):(cov_z6zv9b7aa().b[0][1]++,'DEFAULT'));const actor=(cov_z6zv9b7aa().s[6]++,req.session.form?(cov_z6zv9b7aa().b[2][0]++,(cov_z6zv9b7aa().b[3][0]++,req.session.form.actor)||(cov_z6zv9b7aa().b[3][1]++,'')):(cov_z6zv9b7aa().b[2][1]++,''));cov_z6zv9b7aa().s[7]++;try{const journey=(cov_z6zv9b7aa().s[8]++,getBaseJourney(journeyName)(actor.toLowerCase()));cov_z6zv9b7aa().s[9]++;if(journey.toggledQuestions){cov_z6zv9b7aa().b[4][0]++;cov_z6zv9b7aa().s[10]++;journey.skipList=await processToggledQuestions(journey.toggledQuestions,req,res);}else{cov_z6zv9b7aa().b[4][1]++;}cov_z6zv9b7aa().s[11]++;req.session.journey=journey;}catch(err){cov_z6zv9b7aa().s[12]++;logger(req.session.sessionId).error(err);cov_z6zv9b7aa().s[13]++;req.session.journey=require('app/journeys/default')();}cov_z6zv9b7aa().s[14]++;return req.session.journey;};cov_z6zv9b7aa().s[15]++;const processToggledQuestions=(toggledQuestions,req,res)=>{cov_z6zv9b7aa().f[2]++;const promises=(cov_z6zv9b7aa().s[16]++,toggledQuestions.map(tq=>{cov_z6zv9b7aa().f[3]++;cov_z6zv9b7aa().s[17]++;return featureToggle.checkToggle(tq.ftKey,req,res);}));cov_z6zv9b7aa().s[18]++;return Promise.all(promises).then(values=>{cov_z6zv9b7aa().f[4]++;const skipList=(cov_z6zv9b7aa().s[19]++,[]);cov_z6zv9b7aa().s[20]++;toggledQuestions.forEach((tq,i)=>{cov_z6zv9b7aa().f[5]++;cov_z6zv9b7aa().s[21]++;if(values[i]===false){cov_z6zv9b7aa().b[5][0]++;cov_z6zv9b7aa().s[22]++;skipList.push({stepName:tq.stepName,...((cov_z6zv9b7aa().b[6][0]++,tq.nextStepName)&&(cov_z6zv9b7aa().b[6][1]++,{nextStepName:tq.nextStepName}))});}else{cov_z6zv9b7aa().b[5][1]++;}});cov_z6zv9b7aa().s[23]++;return skipList;}).catch(()=>{cov_z6zv9b7aa().f[6]++;cov_z6zv9b7aa().s[24]++;logger(req.session.sessionId).error('ERROR retrieving skip list toggles; defaulting all to skip');/*
             * If there was an error retrieving the toggles, we skip all questions that have toggles in order to prevent
             * a question from being erroneously shown to a user.
             */cov_z6zv9b7aa().s[25]++;return toggledQuestions.map(tq=>{cov_z6zv9b7aa().f[7]++;cov_z6zv9b7aa().s[26]++;return{stepName:tq.stepName};});});};cov_z6zv9b7aa().s[27]++;module.exports=setJourney;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJmZWF0dXJlVG9nZ2xlIiwicmVxdWlyZSIsImxvZ2dlciIsImdldEJhc2VKb3VybmV5IiwibmFtZSIsInRvTG93ZXJDYXNlIiwic2V0Sm91cm5leSIsInJlcSIsInJlcyIsImpvdXJuZXlOYW1lIiwic2Vzc2lvbiIsImZvcm0iLCJzZXJ2aWNlSWQiLCJhY3RvciIsImpvdXJuZXkiLCJ0b2dnbGVkUXVlc3Rpb25zIiwic2tpcExpc3QiLCJwcm9jZXNzVG9nZ2xlZFF1ZXN0aW9ucyIsImVyciIsInNlc3Npb25JZCIsImVycm9yIiwicHJvbWlzZXMiLCJtYXAiLCJ0cSIsImNoZWNrVG9nZ2xlIiwiZnRLZXkiLCJQcm9taXNlIiwiYWxsIiwidGhlbiIsInZhbHVlcyIsImZvckVhY2giLCJpIiwicHVzaCIsInN0ZXBOYW1lIiwibmV4dFN0ZXBOYW1lIiwiY2F0Y2giLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsic2V0Sm91cm5leS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5jb25zdCBmZWF0dXJlVG9nZ2xlID0gbmV3IChyZXF1aXJlKCdhcHAvdXRpbHMvRmVhdHVyZVRvZ2dsZScpKSgpO1xuY29uc3QgbG9nZ2VyID0gcmVxdWlyZSgnYXBwL2NvbXBvbmVudHMvbG9nZ2VyJyk7XG5cbmNvbnN0IGdldEJhc2VKb3VybmV5ID0gbmFtZSA9PiB7XG4gICAgcmV0dXJuIHJlcXVpcmUoYGFwcC9qb3VybmV5cy8ke25hbWUudG9Mb3dlckNhc2UoKX1gKTtcbn07XG5cbmNvbnN0IHNldEpvdXJuZXkgPSBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICBjb25zdCBqb3VybmV5TmFtZSA9IHJlcS5zZXNzaW9uLmZvcm0gPyByZXEuc2Vzc2lvbi5mb3JtLnNlcnZpY2VJZCB8fCAnREVGQVVMVCcgOiAnREVGQVVMVCc7XG4gICAgY29uc3QgYWN0b3IgPSByZXEuc2Vzc2lvbi5mb3JtID8gcmVxLnNlc3Npb24uZm9ybS5hY3RvciB8fCAnJyA6ICcnO1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgam91cm5leSA9IGdldEJhc2VKb3VybmV5KGpvdXJuZXlOYW1lKShhY3Rvci50b0xvd2VyQ2FzZSgpKTtcblxuICAgICAgICBpZiAoam91cm5leS50b2dnbGVkUXVlc3Rpb25zKSB7XG4gICAgICAgICAgICBqb3VybmV5LnNraXBMaXN0ID0gYXdhaXQgcHJvY2Vzc1RvZ2dsZWRRdWVzdGlvbnMoam91cm5leS50b2dnbGVkUXVlc3Rpb25zLCByZXEsIHJlcyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXEuc2Vzc2lvbi5qb3VybmV5ID0gam91cm5leTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgbG9nZ2VyKHJlcS5zZXNzaW9uLnNlc3Npb25JZCkuZXJyb3IoZXJyKTtcbiAgICAgICAgcmVxLnNlc3Npb24uam91cm5leSA9IHJlcXVpcmUoJ2FwcC9qb3VybmV5cy9kZWZhdWx0JykoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVxLnNlc3Npb24uam91cm5leTtcbn07XG5cbmNvbnN0IHByb2Nlc3NUb2dnbGVkUXVlc3Rpb25zID0gKHRvZ2dsZWRRdWVzdGlvbnMsIHJlcSwgcmVzKSA9PiB7XG4gICAgY29uc3QgcHJvbWlzZXMgPSB0b2dnbGVkUXVlc3Rpb25zLm1hcCh0cSA9PiBmZWF0dXJlVG9nZ2xlLmNoZWNrVG9nZ2xlKHRxLmZ0S2V5LCByZXEsIHJlcykpO1xuICAgIHJldHVybiBQcm9taXNlLmFsbChwcm9taXNlcylcbiAgICAgICAgLnRoZW4odmFsdWVzID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHNraXBMaXN0ID0gW107XG4gICAgICAgICAgICB0b2dnbGVkUXVlc3Rpb25zLmZvckVhY2goKHRxLCBpKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlc1tpXSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgc2tpcExpc3QucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGVwTmFtZTogdHEuc3RlcE5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi4odHEubmV4dFN0ZXBOYW1lICYmIHtuZXh0U3RlcE5hbWU6IHRxLm5leHRTdGVwTmFtZX0pXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHNraXBMaXN0O1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKCkgPT4ge1xuICAgICAgICAgICAgbG9nZ2VyKHJlcS5zZXNzaW9uLnNlc3Npb25JZCkuZXJyb3IoJ0VSUk9SIHJldHJpZXZpbmcgc2tpcCBsaXN0IHRvZ2dsZXM7IGRlZmF1bHRpbmcgYWxsIHRvIHNraXAnKTtcblxuICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAqIElmIHRoZXJlIHdhcyBhbiBlcnJvciByZXRyaWV2aW5nIHRoZSB0b2dnbGVzLCB3ZSBza2lwIGFsbCBxdWVzdGlvbnMgdGhhdCBoYXZlIHRvZ2dsZXMgaW4gb3JkZXIgdG8gcHJldmVudFxuICAgICAgICAgICAgICogYSBxdWVzdGlvbiBmcm9tIGJlaW5nIGVycm9uZW91c2x5IHNob3duIHRvIGEgdXNlci5cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgcmV0dXJuIHRvZ2dsZWRRdWVzdGlvbnMubWFwKHRxID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge3N0ZXBOYW1lOiB0cS5zdGVwTmFtZX07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHNldEpvdXJuZXk7XG4iXSwibWFwcGluZ3MiOiJBQUFBLGEsOCtKQWVZO3lGQWRaLEtBQU1BLGNBQWEseUJBQUcsSUFBS0MsT0FBTyxDQUFDLHlCQUFELENBQVosR0FBSCxDQUFuQixDQUNBLEtBQU1DLE9BQU0seUJBQUdELE9BQU8sQ0FBQyx1QkFBRCxDQUFWLENBQVosQyx1QkFFQSxLQUFNRSxlQUFjLENBQUdDLElBQUksRUFBSSwrQ0FD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