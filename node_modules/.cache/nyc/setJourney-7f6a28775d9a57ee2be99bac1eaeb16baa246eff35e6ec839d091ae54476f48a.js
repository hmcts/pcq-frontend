'use strict';function cov_z6zv9b7aa(){var path="/Users/bradleywadsworth/development/reform/pcq-frontend/app/middleware/setJourney.js";var hash="55f4d23c77465d12196d482cd37fbafc6894e47d";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/bradleywadsworth/development/reform/pcq-frontend/app/middleware/setJourney.js",statementMap:{"0":{start:{line:2,column:22},end:{line:2,column:64}},"1":{start:{line:3,column:15},end:{line:3,column:47}},"2":{start:{line:5,column:23},end:{line:7,column:1}},"3":{start:{line:6,column:4},end:{line:6,column:57}},"4":{start:{line:9,column:19},end:{line:53,column:1}},"5":{start:{line:10,column:24},end:{line:10,column:94}},"6":{start:{line:11,column:18},end:{line:11,column:70}},"7":{start:{line:12,column:21},end:{line:12,column:41}},"8":{start:{line:14,column:4},end:{line:50,column:5}},"9":{start:{line:15,column:24},end:{line:15,column:72}},"10":{start:{line:17,column:8},end:{line:19,column:9}},"11":{start:{line:18,column:12},end:{line:18,column:97}},"12":{start:{line:21,column:8},end:{line:44,column:9}},"13":{start:{line:22,column:12},end:{line:43,column:13}},"14":{start:{line:26,column:41},end:{line:26,column:76}},"15":{start:{line:29,column:16},end:{line:40,column:19}},"16":{start:{line:31,column:42},end:{line:31,column:118}},"17":{start:{line:31,column:79},end:{line:31,column:117}},"18":{start:{line:32,column:20},end:{line:39,column:21}},"19":{start:{line:34,column:24},end:{line:36,column:25}},"20":{start:{line:35,column:28},end:{line:35,column:164}},"21":{start:{line:38,column:24},end:{line:38,column:52}},"22":{start:{line:42,column:16},end:{line:42,column:71}},"23":{start:{line:46,column:8},end:{line:46,column:38}},"24":{start:{line:48,column:8},end:{line:48,column:49}},"25":{start:{line:49,column:8},end:{line:49,column:64}},"26":{start:{line:52,column:4},end:{line:52,column:31}},"27":{start:{line:55,column:32},end:{line:81,column:1}},"28":{start:{line:56,column:21},end:{line:56,column:94}},"29":{start:{line:56,column:48},end:{line:56,column:93}},"30":{start:{line:57,column:4},end:{line:80,column:11}},"31":{start:{line:59,column:29},end:{line:59,column:31}},"32":{start:{line:60,column:12},end:{line:67,column:15}},"33":{start:{line:61,column:16},end:{line:66,column:17}},"34":{start:{line:62,column:20},end:{line:65,column:23}},"35":{start:{line:68,column:12},end:{line:68,column:28}},"36":{start:{line:71,column:12},end:{line:71,column:110}},"37":{start:{line:77,column:12},end:{line:79,column:15}},"38":{start:{line:78,column:16},end:{line:78,column:47}},"39":{start:{line:83,column:0},end:{line:83,column:28}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:5,column:23},end:{line:5,column:24}},loc:{start:{line:5,column:31},end:{line:7,column:1}},line:5},"1":{name:"(anonymous_1)",decl:{start:{line:9,column:19},end:{line:9,column:20}},loc:{start:{line:9,column:39},end:{line:53,column:1}},line:9},"2":{name:"(anonymous_2)",decl:{start:{line:29,column:41},end:{line:29,column:42}},loc:{start:{line:29,column:49},end:{line:40,column:17}},line:29},"3":{name:"(anonymous_3)",decl:{start:{line:31,column:64},end:{line:31,column:65}},loc:{start:{line:31,column:79},end:{line:31,column:117}},line:31},"4":{name:"(anonymous_4)",decl:{start:{line:55,column:32},end:{line:55,column:33}},loc:{start:{line:55,column:64},end:{line:81,column:1}},line:55},"5":{name:"(anonymous_5)",decl:{start:{line:56,column:42},end:{line:56,column:43}},loc:{start:{line:56,column:48},end:{line:56,column:93}},line:56},"6":{name:"(anonymous_6)",decl:{start:{line:58,column:14},end:{line:58,column:15}},loc:{start:{line:58,column:24},end:{line:69,column:9}},line:58},"7":{name:"(anonymous_7)",decl:{start:{line:60,column:37},end:{line:60,column:38}},loc:{start:{line:60,column:48},end:{line:67,column:13}},line:60},"8":{name:"(anonymous_8)",decl:{start:{line:70,column:15},end:{line:70,column:16}},loc:{start:{line:70,column:21},end:{line:80,column:9}},line:70},"9":{name:"(anonymous_9)",decl:{start:{line:77,column:40},end:{line:77,column:41}},loc:{start:{line:77,column:46},end:{line:79,column:13}},line:77}},branchMap:{"0":{loc:{start:{line:10,column:24},end:{line:10,column:94}},type:"cond-expr",locations:[{start:{line:10,column:43},end:{line:10,column:82}},{start:{line:10,column:85},end:{line:10,column:94}}],line:10},"1":{loc:{start:{line:10,column:43},end:{line:10,column:82}},type:"binary-expr",locations:[{start:{line:10,column:43},end:{line:10,column:69}},{start:{line:10,column:73},end:{line:10,column:82}}],line:10},"2":{loc:{start:{line:11,column:18},end:{line:11,column:70}},type:"cond-expr",locations:[{start:{line:11,column:37},end:{line:11,column:65}},{start:{line:11,column:68},end:{line:11,column:70}}],line:11},"3":{loc:{start:{line:11,column:37},end:{line:11,column:65}},type:"binary-expr",locations:[{start:{line:11,column:37},end:{line:11,column:59}},{start:{line:11,column:63},end:{line:11,column:65}}],line:11},"4":{loc:{start:{line:17,column:8},end:{line:19,column:9}},type:"if",locations:[{start:{line:17,column:8},end:{line:19,column:9}},{start:{line:17,column:8},end:{line:19,column:9}}],line:17},"5":{loc:{start:{line:21,column:8},end:{line:44,column:9}},type:"if",locations:[{start:{line:21,column:8},end:{line:44,column:9}},{start:{line:21,column:8},end:{line:44,column:9}}],line:21},"6":{loc:{start:{line:21,column:12},end:{line:21,column:97}},type:"binary-expr",locations:[{start:{line:21,column:12},end:{line:21,column:37}},{start:{line:21,column:41},end:{line:21,column:58}},{start:{line:21,column:62},end:{line:21,column:97}}],line:21},"7":{loc:{start:{line:22,column:12},end:{line:43,column:13}},type:"if",locations:[{start:{line:22,column:12},end:{line:43,column:13}},{start:{line:22,column:12},end:{line:43,column:13}}],line:22},"8":{loc:{start:{line:32,column:20},end:{line:39,column:21}},type:"if",locations:[{start:{line:32,column:20},end:{line:39,column:21}},{start:{line:32,column:20},end:{line:39,column:21}}],line:32},"9":{loc:{start:{line:34,column:24},end:{line:36,column:25}},type:"if",locations:[{start:{line:34,column:24},end:{line:36,column:25}},{start:{line:34,column:24},end:{line:36,column:25}}],line:34},"10":{loc:{start:{line:61,column:16},end:{line:66,column:17}},type:"if",locations:[{start:{line:61,column:16},end:{line:66,column:17}},{start:{line:61,column:16},end:{line:66,column:17}}],line:61},"11":{loc:{start:{line:64,column:28},end:{line:64,column:78}},type:"binary-expr",locations:[{start:{line:64,column:28},end:{line:64,column:43}},{start:{line:64,column:47},end:{line:64,column:78}}],line:64}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"55f4d23c77465d12196d482cd37fbafc6894e47d"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_z6zv9b7aa=function(){return actualCoverage;};}return actualCoverage;}cov_z6zv9b7aa();let featureToggle=(cov_z6zv9b7aa().s[0]++,new(require('app/utils/FeatureToggle'))());let logger=(cov_z6zv9b7aa().s[1]++,require('app/components/logger'));cov_z6zv9b7aa().s[2]++;let getBaseJourney=name=>{cov_z6zv9b7aa().f[0]++;cov_z6zv9b7aa().s[3]++;return require(`app/journeys/${name.toLowerCase()}`);};cov_z6zv9b7aa().s[4]++;let setJourney=async(req,res)=>{cov_z6zv9b7aa().f[1]++;let journeyName=(cov_z6zv9b7aa().s[5]++,req.session.form?(cov_z6zv9b7aa().b[0][0]++,(cov_z6zv9b7aa().b[1][0]++,req.session.form.serviceId)||(cov_z6zv9b7aa().b[1][1]++,'DEFAULT')):(cov_z6zv9b7aa().b[0][1]++,'DEFAULT'));let actor=(cov_z6zv9b7aa().s[6]++,req.session.form?(cov_z6zv9b7aa().b[2][0]++,(cov_z6zv9b7aa().b[3][0]++,req.session.form.actor)||(cov_z6zv9b7aa().b[3][1]++,'')):(cov_z6zv9b7aa().b[2][1]++,''));let ageCheck=(cov_z6zv9b7aa().s[7]++,req.session.ageCheck);cov_z6zv9b7aa().s[8]++;try{let journey=(cov_z6zv9b7aa().s[9]++,getBaseJourney(journeyName)(actor.toLowerCase()));cov_z6zv9b7aa().s[10]++;if(journey.toggledQuestions){cov_z6zv9b7aa().b[4][0]++;cov_z6zv9b7aa().s[11]++;journey.skipList=await processToggledQuestions(journey.toggledQuestions,req,res);}else{cov_z6zv9b7aa().b[4][1]++;}cov_z6zv9b7aa().s[12]++;if((cov_z6zv9b7aa().b[6][0]++,journey.ageCheckQuestions)&&(cov_z6zv9b7aa().b[6][1]++,ageCheck!==null)&&(cov_z6zv9b7aa().b[6][2]++,journey.ageCheckQuestions[ageCheck])){cov_z6zv9b7aa().b[5][0]++;cov_z6zv9b7aa().s[13]++;if(journey.skipList){cov_z6zv9b7aa().b[7][0]++;// Add the age check skip list questions, ensuring to merge any duplicates from the toggled questions.
// If any merges cause confliction, then log an error and prioritise the toggle item.
let ageCheckSkipList=(cov_z6zv9b7aa().s[14]++,journey.ageCheckQuestions[ageCheck]);// Loop through each of the items in age check questions.
cov_z6zv9b7aa().s[15]++;ageCheckSkipList.forEach(item=>{cov_z6zv9b7aa().f[2]++;// If the step name is already in the skip list
let duplicateItem=(cov_z6zv9b7aa().s[16]++,journey.skipList.find(skippedItem=>{cov_z6zv9b7aa().f[3]++;cov_z6zv9b7aa().s[17]++;return skippedItem.stepName===item.stepName;}));cov_z6zv9b7aa().s[18]++;if(duplicateItem){cov_z6zv9b7aa().b[8][0]++;cov_z6zv9b7aa().s[19]++;// If they have a next step, ensure they are the same, otherwise, log an error and prioritise the toggle.
if(item.nextStepName!==duplicateItem.nextStepName){cov_z6zv9b7aa().b[9][0]++;cov_z6zv9b7aa().s[20]++;logger(req.session.sessionId).error('ERROR Duplicated skip list item has different nextStepName. Prioritising toggled skip list item.');}else{cov_z6zv9b7aa().b[9][1]++;}}else{cov_z6zv9b7aa().b[8][1]++;cov_z6zv9b7aa().s[21]++;journey.skipList.push(item);}});}else{cov_z6zv9b7aa().b[7][1]++;cov_z6zv9b7aa().s[22]++;journey.skipList=journey.ageCheckQuestions[ageCheck];}}else{cov_z6zv9b7aa().b[5][1]++;}cov_z6zv9b7aa().s[23]++;req.session.journey=journey;}catch(err){cov_z6zv9b7aa().s[24]++;logger(req.session.sessionId).error(err);cov_z6zv9b7aa().s[25]++;req.session.journey=require('app/journeys/default')();}cov_z6zv9b7aa().s[26]++;return req.session.journey;};cov_z6zv9b7aa().s[27]++;let processToggledQuestions=(toggledQuestions,req,res)=>{cov_z6zv9b7aa().f[4]++;let promises=(cov_z6zv9b7aa().s[28]++,toggledQuestions.map(tq=>{cov_z6zv9b7aa().f[5]++;cov_z6zv9b7aa().s[29]++;return featureToggle.checkToggle(tq.ftKey,req,res);}));cov_z6zv9b7aa().s[30]++;return Promise.all(promises).then(values=>{cov_z6zv9b7aa().f[6]++;let skipList=(cov_z6zv9b7aa().s[31]++,[]);cov_z6zv9b7aa().s[32]++;toggledQuestions.forEach((tq,i)=>{cov_z6zv9b7aa().f[7]++;cov_z6zv9b7aa().s[33]++;if(values[i]===false){cov_z6zv9b7aa().b[10][0]++;cov_z6zv9b7aa().s[34]++;skipList.push({stepName:tq.stepName,...((cov_z6zv9b7aa().b[11][0]++,tq.nextStepName)&&(cov_z6zv9b7aa().b[11][1]++,{nextStepName:tq.nextStepName}))});}else{cov_z6zv9b7aa().b[10][1]++;}});cov_z6zv9b7aa().s[35]++;return skipList;}).catch(()=>{cov_z6zv9b7aa().f[8]++;cov_z6zv9b7aa().s[36]++;logger(req.session.sessionId).error('ERROR retrieving skip list toggles; defaulting all to skip');/*
             * If there was an error retrieving the toggles, we skip all questions that have toggles in order to prevent
             * a question from being erroneously shown to a user.
             */cov_z6zv9b7aa().s[37]++;return toggledQuestions.map(tq=>{cov_z6zv9b7aa().f[9]++;cov_z6zv9b7aa().s[38]++;return{stepName:tq.stepName};});});};cov_z6zv9b7aa().s[39]++;module.exports=setJourney;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJmZWF0dXJlVG9nZ2xlIiwicmVxdWlyZSIsImxvZ2dlciIsImdldEJhc2VKb3VybmV5IiwibmFtZSIsInRvTG93ZXJDYXNlIiwic2V0Sm91cm5leSIsInJlcSIsInJlcyIsImpvdXJuZXlOYW1lIiwic2Vzc2lvbiIsImZvcm0iLCJzZXJ2aWNlSWQiLCJhY3RvciIsImFnZUNoZWNrIiwiam91cm5leSIsInRvZ2dsZWRRdWVzdGlvbnMiLCJza2lwTGlzdCIsInByb2Nlc3NUb2dnbGVkUXVlc3Rpb25zIiwiYWdlQ2hlY2tRdWVzdGlvbnMiLCJhZ2VDaGVja1NraXBMaXN0IiwiZm9yRWFjaCIsIml0ZW0iLCJkdXBsaWNhdGVJdGVtIiwiZmluZCIsInNraXBwZWRJdGVtIiwic3RlcE5hbWUiLCJuZXh0U3RlcE5hbWUiLCJzZXNzaW9uSWQiLCJlcnJvciIsInB1c2giLCJlcnIiLCJwcm9taXNlcyIsIm1hcCIsInRxIiwiY2hlY2tUb2dnbGUiLCJmdEtleSIsIlByb21pc2UiLCJhbGwiLCJ0aGVuIiwidmFsdWVzIiwiaSIsImNhdGNoIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInNldEpvdXJuZXkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xubGV0ICAgZmVhdHVyZVRvZ2dsZSA9IG5ldyAocmVxdWlyZSgnYXBwL3V0aWxzL0ZlYXR1cmVUb2dnbGUnKSkoKTtcbmxldCAgIGxvZ2dlciA9IHJlcXVpcmUoJ2FwcC9jb21wb25lbnRzL2xvZ2dlcicpO1xuXG5sZXQgICBnZXRCYXNlSm91cm5leSA9IG5hbWUgPT4ge1xuICAgIHJldHVybiByZXF1aXJlKGBhcHAvam91cm5leXMvJHtuYW1lLnRvTG93ZXJDYXNlKCl9YCk7XG59O1xuXG5sZXQgICBzZXRKb3VybmV5ID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgbGV0ICAgam91cm5leU5hbWUgPSByZXEuc2Vzc2lvbi5mb3JtID8gcmVxLnNlc3Npb24uZm9ybS5zZXJ2aWNlSWQgfHwgJ0RFRkFVTFQnIDogJ0RFRkFVTFQnO1xuICAgIGxldCAgIGFjdG9yID0gcmVxLnNlc3Npb24uZm9ybSA/IHJlcS5zZXNzaW9uLmZvcm0uYWN0b3IgfHwgJycgOiAnJztcbiAgICBsZXQgICBhZ2VDaGVjayA9IHJlcS5zZXNzaW9uLmFnZUNoZWNrO1xuXG4gICAgdHJ5IHtcbiAgICAgICAgbGV0ICAgam91cm5leSA9IGdldEJhc2VKb3VybmV5KGpvdXJuZXlOYW1lKShhY3Rvci50b0xvd2VyQ2FzZSgpKTtcblxuICAgICAgICBpZiAoam91cm5leS50b2dnbGVkUXVlc3Rpb25zKSB7XG4gICAgICAgICAgICBqb3VybmV5LnNraXBMaXN0ID0gYXdhaXQgcHJvY2Vzc1RvZ2dsZWRRdWVzdGlvbnMoam91cm5leS50b2dnbGVkUXVlc3Rpb25zLCByZXEsIHJlcyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoam91cm5leS5hZ2VDaGVja1F1ZXN0aW9ucyAmJiBhZ2VDaGVjayAhPT0gbnVsbCAmJiBqb3VybmV5LmFnZUNoZWNrUXVlc3Rpb25zW2FnZUNoZWNrXSkge1xuICAgICAgICAgICAgaWYgKGpvdXJuZXkuc2tpcExpc3QpIHtcbiAgICAgICAgICAgICAgICAvLyBBZGQgdGhlIGFnZSBjaGVjayBza2lwIGxpc3QgcXVlc3Rpb25zLCBlbnN1cmluZyB0byBtZXJnZSBhbnkgZHVwbGljYXRlcyBmcm9tIHRoZSB0b2dnbGVkIHF1ZXN0aW9ucy5cbiAgICAgICAgICAgICAgICAvLyBJZiBhbnkgbWVyZ2VzIGNhdXNlIGNvbmZsaWN0aW9uLCB0aGVuIGxvZyBhbiBlcnJvciBhbmQgcHJpb3JpdGlzZSB0aGUgdG9nZ2xlIGl0ZW0uXG5cbiAgICAgICAgICAgICAgICBsZXQgICBhZ2VDaGVja1NraXBMaXN0ID0gam91cm5leS5hZ2VDaGVja1F1ZXN0aW9uc1thZ2VDaGVja107XG5cbiAgICAgICAgICAgICAgICAvLyBMb29wIHRocm91Z2ggZWFjaCBvZiB0aGUgaXRlbXMgaW4gYWdlIGNoZWNrIHF1ZXN0aW9ucy5cbiAgICAgICAgICAgICAgICBhZ2VDaGVja1NraXBMaXN0LmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBzdGVwIG5hbWUgaXMgYWxyZWFkeSBpbiB0aGUgc2tpcCBsaXN0XG4gICAgICAgICAgICAgICAgICAgIGxldCAgIGR1cGxpY2F0ZUl0ZW0gPSBqb3VybmV5LnNraXBMaXN0LmZpbmQoc2tpcHBlZEl0ZW0gPT4gc2tpcHBlZEl0ZW0uc3RlcE5hbWUgPT09IGl0ZW0uc3RlcE5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZHVwbGljYXRlSXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhleSBoYXZlIGEgbmV4dCBzdGVwLCBlbnN1cmUgdGhleSBhcmUgdGhlIHNhbWUsIG90aGVyd2lzZSwgbG9nIGFuIGVycm9yIGFuZCBwcmlvcml0aXNlIHRoZSB0b2dnbGUuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5uZXh0U3RlcE5hbWUgIT09IGR1cGxpY2F0ZUl0ZW0ubmV4dFN0ZXBOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyKHJlcS5zZXNzaW9uLnNlc3Npb25JZCkuZXJyb3IoJ0VSUk9SIER1cGxpY2F0ZWQgc2tpcCBsaXN0IGl0ZW0gaGFzIGRpZmZlcmVudCBuZXh0U3RlcE5hbWUuIFByaW9yaXRpc2luZyB0b2dnbGVkIHNraXAgbGlzdCBpdGVtLicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgam91cm5leS5za2lwTGlzdC5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGpvdXJuZXkuc2tpcExpc3QgPSBqb3VybmV5LmFnZUNoZWNrUXVlc3Rpb25zW2FnZUNoZWNrXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJlcS5zZXNzaW9uLmpvdXJuZXkgPSBqb3VybmV5O1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBsb2dnZXIocmVxLnNlc3Npb24uc2Vzc2lvbklkKS5lcnJvcihlcnIpO1xuICAgICAgICByZXEuc2Vzc2lvbi5qb3VybmV5ID0gcmVxdWlyZSgnYXBwL2pvdXJuZXlzL2RlZmF1bHQnKSgpO1xuICAgIH1cblxuICAgIHJldHVybiByZXEuc2Vzc2lvbi5qb3VybmV5O1xufTtcblxubGV0ICAgcHJvY2Vzc1RvZ2dsZWRRdWVzdGlvbnMgPSAodG9nZ2xlZFF1ZXN0aW9ucywgcmVxLCByZXMpID0+IHtcbiAgICBsZXQgICBwcm9taXNlcyA9IHRvZ2dsZWRRdWVzdGlvbnMubWFwKHRxID0+IGZlYXR1cmVUb2dnbGUuY2hlY2tUb2dnbGUodHEuZnRLZXksIHJlcSwgcmVzKSk7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKHByb21pc2VzKVxuICAgICAgICAudGhlbih2YWx1ZXMgPT4ge1xuICAgICAgICAgICAgbGV0ICAgc2tpcExpc3QgPSBbXTtcbiAgICAgICAgICAgIHRvZ2dsZWRRdWVzdGlvbnMuZm9yRWFjaCgodHEsIGkpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWVzW2ldID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICBza2lwTGlzdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXBOYW1lOiB0cS5zdGVwTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLih0cS5uZXh0U3RlcE5hbWUgJiYge25leHRTdGVwTmFtZTogdHEubmV4dFN0ZXBOYW1lfSlcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gc2tpcExpc3Q7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoKSA9PiB7XG4gICAgICAgICAgICBsb2dnZXIocmVxLnNlc3Npb24uc2Vzc2lvbklkKS5lcnJvcignRVJST1IgcmV0cmlldmluZyBza2lwIGxpc3QgdG9nZ2xlczsgZGVmYXVsdGluZyBhbGwgdG8gc2tpcCcpO1xuXG4gICAgICAgICAgICAvKlxuICAgICAgICAgICAgICogSWYgdGhlcmUgd2FzIGFuIGVycm9yIHJldHJpZXZpbmcgdGhlIHRvZ2dsZXMsIHdlIHNraXAgYWxsIHF1ZXN0aW9ucyB0aGF0IGhhdmUgdG9nZ2xlcyBpbiBvcmRlciB0byBwcmV2ZW50XG4gICAgICAgICAgICAgKiBhIHF1ZXN0aW9uIGZyb20gYmVpbmcgZXJyb25lb3VzbHkgc2hvd24gdG8gYSB1c2VyLlxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICByZXR1cm4gdG9nZ2xlZFF1ZXN0aW9ucy5tYXAodHEgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB7c3RlcE5hbWU6IHRxLnN0ZXBOYW1lfTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gc2V0Sm91cm5leTtcbiJdLCJtYXBwaW5ncyI6IkFBQUEsYSx1bU9BZVk7eUZBZFosR0FBTUEsY0FBYSx5QkFBRyxJQUFLQyxPQUFPLENBQUMseUJBQUQsQ0FBWixHQUFILENBQW5CLENBQ0EsR0FBTUMsT0FBTSx5QkFBR0QsT0FBTyxDQUFDLHVCQUFELENBQVYsQ0FBWixDLHVCQUVBLEdBQU1FLGVBQWMsQ0FBR0MsSUFBSSxFQUFJLCtDQUMzQixNQUFPSCxRQUFPLENBQUUsZ0JBQWVHLElBQUksQ0FBQ0MsV0FBTCxFQUFtQixFQUFwQyxDQUFkLENBQ0gsQ0FGRCxDLHVCQUlBLEdBQU1DLFdBQVUsQ0FBRyxNQUFPQyxHQUFQLENBQVlDLEdBQVosR0FBb0Isd0JBQ25DLEdBQU1DLFlBQVcseUJBQUdGLEdBQUcsQ0FBQ0csT0FBSixDQUFZQyxJQUFaLDRCQUFtQiwyQkFBQUosR0FBRyxDQUFDRyxPQUFK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