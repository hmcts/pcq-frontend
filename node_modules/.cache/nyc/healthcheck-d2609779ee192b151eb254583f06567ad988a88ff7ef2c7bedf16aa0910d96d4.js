'use strict';function cov_1jwrezlyzt(){var path="/Users/bradleywadsworth/development/reform/pcq-frontend/app/healthcheck.js";var hash="25244085fcea436a13b6e7e90fa5b0dfe6cc9f47";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/bradleywadsworth/development/reform/pcq-frontend/app/healthcheck.js",statementMap:{"0":{start:{line:3,column:20},end:{line:3,column:56}},"1":{start:{line:4,column:15},end:{line:4,column:55}},"2":{start:{line:5,column:11},end:{line:5,column:24}},"3":{start:{line:6,column:15},end:{line:6,column:32}},"4":{start:{line:8,column:15},end:{line:8,column:17}},"5":{start:{line:9,column:24},end:{line:9,column:26}},"6":{start:{line:11,column:0},end:{line:24,column:1}},"7":{start:{line:12,column:4},end:{line:23,column:7}},"8":{start:{line:14,column:27},end:{line:14,column:67}},"9":{start:{line:15,column:12},end:{line:18,column:13}},"10":{start:{line:16,column:16},end:{line:16,column:51}},"11":{start:{line:17,column:16},end:{line:17,column:33}},"12":{start:{line:19,column:12},end:{line:19,column:75}},"13":{start:{line:26,column:14},end:{line:36,column:1}},"14":{start:{line:27,column:4},end:{line:35,column:7}},"15":{start:{line:38,column:0},end:{line:40,column:2}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:13,column:18},end:{line:13,column:19}},loc:{start:{line:13,column:32},end:{line:20,column:9}},line:13},"1":{name:"(anonymous_1)",decl:{start:{line:26,column:14},end:{line:26,column:15}},loc:{start:{line:26,column:21},end:{line:36,column:1}},line:26}},branchMap:{"0":{loc:{start:{line:11,column:0},end:{line:24,column:1}},type:"if",locations:[{start:{line:11,column:0},end:{line:24,column:1}},{start:{line:11,column:0},end:{line:24,column:1}}],line:11},"1":{loc:{start:{line:14,column:27},end:{line:14,column:67}},type:"cond-expr",locations:[{start:{line:14,column:33},end:{line:14,column:39}},{start:{line:14,column:42},end:{line:14,column:67}}],line:14},"2":{loc:{start:{line:14,column:42},end:{line:14,column:67}},type:"binary-expr",locations:[{start:{line:14,column:42},end:{line:14,column:57}},{start:{line:14,column:61},end:{line:14,column:67}}],line:14},"3":{loc:{start:{line:15,column:12},end:{line:18,column:13}},type:"if",locations:[{start:{line:15,column:12},end:{line:18,column:13}},{start:{line:15,column:12},end:{line:18,column:13}}],line:15},"4":{loc:{start:{line:19,column:19},end:{line:19,column:74}},type:"cond-expr",locations:[{start:{line:19,column:37},end:{line:19,column:53}},{start:{line:19,column:56},end:{line:19,column:74}}],line:19}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"25244085fcea436a13b6e7e90fa5b0dfe6cc9f47"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1jwrezlyzt=function(){return actualCoverage;};}return actualCoverage;}cov_1jwrezlyzt();const healthcheck=(cov_1jwrezlyzt().s[0]++,require('@hmcts/nodejs-healthcheck'));const logger=(cov_1jwrezlyzt().s[1]++,require('app/components/logger')('Init'));const os=(cov_1jwrezlyzt().s[2]++,require('os'));const config=(cov_1jwrezlyzt().s[3]++,require('config'));const checks=(cov_1jwrezlyzt().s[4]++,{});const readinessChecks=(cov_1jwrezlyzt().s[5]++,{});cov_1jwrezlyzt().s[6]++;if(config.services.pcqBackend.enabled==='true'){cov_1jwrezlyzt().b[0][0]++;cov_1jwrezlyzt().s[7]++;checks['pcq-backend']=healthcheck.web(`${config.services.pcqBackend.url}/health/readiness`,{callback:(err,res)=>{cov_1jwrezlyzt().f[0]++;const status=(cov_1jwrezlyzt().s[8]++,err?(cov_1jwrezlyzt().b[1][0]++,'DOWN'):(cov_1jwrezlyzt().b[1][1]++,(cov_1jwrezlyzt().b[2][0]++,res.body.status)||(cov_1jwrezlyzt().b[2][1]++,'DOWN')));cov_1jwrezlyzt().s[9]++;if(status==='DOWN'){cov_1jwrezlyzt().b[3][0]++;cov_1jwrezlyzt().s[10]++;logger.warn('pcq-backend is DOWN');cov_1jwrezlyzt().s[11]++;logger.warn(err);}else{cov_1jwrezlyzt().b[3][1]++;}cov_1jwrezlyzt().s[12]++;return status==='UP'?(cov_1jwrezlyzt().b[4][0]++,healthcheck.up()):(cov_1jwrezlyzt().b[4][1]++,healthcheck.down());},timeout:10000,deadline:20000});}else{cov_1jwrezlyzt().b[0][1]++;}cov_1jwrezlyzt().s[13]++;const setup=app=>{cov_1jwrezlyzt().f[1]++;cov_1jwrezlyzt().s[14]++;healthcheck.addTo(app,{checks:checks,readinessChecks:readinessChecks,buildInfo:{name:config.service.name,host:os.hostname(),uptime:process.uptime()}});};cov_1jwrezlyzt().s[15]++;module.exports={setup:setup};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJoZWFsdGhjaGVjayIsInJlcXVpcmUiLCJsb2dnZXIiLCJvcyIsImNvbmZpZyIsImNoZWNrcyIsInJlYWRpbmVzc0NoZWNrcyIsInNlcnZpY2VzIiwicGNxQmFja2VuZCIsImVuYWJsZWQiLCJ3ZWIiLCJ1cmwiLCJjYWxsYmFjayIsImVyciIsInJlcyIsInN0YXR1cyIsImJvZHkiLCJ3YXJuIiwidXAiLCJkb3duIiwidGltZW91dCIsImRlYWRsaW5lIiwic2V0dXAiLCJhcHAiLCJhZGRUbyIsImJ1aWxkSW5mbyIsIm5hbWUiLCJzZXJ2aWNlIiwiaG9zdCIsImhvc3RuYW1lIiwidXB0aW1lIiwicHJvY2VzcyIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJoZWFsdGhjaGVjay5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IGhlYWx0aGNoZWNrID0gcmVxdWlyZSgnQGhtY3RzL25vZGVqcy1oZWFsdGhjaGVjaycpO1xuY29uc3QgbG9nZ2VyID0gcmVxdWlyZSgnYXBwL2NvbXBvbmVudHMvbG9nZ2VyJykoJ0luaXQnKTtcbmNvbnN0IG9zID0gcmVxdWlyZSgnb3MnKTtcbmNvbnN0IGNvbmZpZyA9IHJlcXVpcmUoJ2NvbmZpZycpO1xuXG5jb25zdCBjaGVja3MgPSB7fTtcbmNvbnN0IHJlYWRpbmVzc0NoZWNrcyA9IHt9O1xuXG5pZiAoY29uZmlnLnNlcnZpY2VzLnBjcUJhY2tlbmQuZW5hYmxlZCA9PT0gJ3RydWUnKSB7XG4gICAgY2hlY2tzWydwY3EtYmFja2VuZCddID0gaGVhbHRoY2hlY2sud2ViKGAke2NvbmZpZy5zZXJ2aWNlcy5wY3FCYWNrZW5kLnVybH0vaGVhbHRoL3JlYWRpbmVzc2AsIHtcbiAgICAgICAgY2FsbGJhY2s6IChlcnIsIHJlcykgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc3RhdHVzID0gZXJyID8gJ0RPV04nIDogcmVzLmJvZHkuc3RhdHVzIHx8ICdET1dOJztcbiAgICAgICAgICAgIGlmIChzdGF0dXMgPT09ICdET1dOJykge1xuICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuKCdwY3EtYmFja2VuZCBpcyBET1dOJyk7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLndhcm4oZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBzdGF0dXMgPT09ICdVUCcgPyBoZWFsdGhjaGVjay51cCgpIDogaGVhbHRoY2hlY2suZG93bigpO1xuICAgICAgICB9LFxuICAgICAgICB0aW1lb3V0OiAxMDAwMCxcbiAgICAgICAgZGVhZGxpbmU6IDIwMDAwXG4gICAgfSk7XG59XG5cbmNvbnN0IHNldHVwID0gYXBwID0+IHtcbiAgICBoZWFsdGhjaGVjay5hZGRUbyhhcHAsIHtcbiAgICAgICAgY2hlY2tzOiBjaGVja3MsXG4gICAgICAgIHJlYWRpbmVzc0NoZWNrczogcmVhZGluZXNzQ2hlY2tzLFxuICAgICAgICBidWlsZEluZm86IHtcbiAgICAgICAgICAgIG5hbWU6IGNvbmZpZy5zZXJ2aWNlLm5hbWUsXG4gICAgICAgICAgICBob3N0OiBvcy5ob3N0bmFtZSgpLFxuICAgICAgICAgICAgdXB0aW1lOiBwcm9jZXNzLnVwdGltZSgpLFxuICAgICAgICB9XG4gICAgfSk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgICBzZXR1cDogc2V0dXBcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBLGEsODVGQWVZOzJGQWJaLEtBQU1BLFlBQVcsMEJBQUdDLE9BQU8sQ0FBQywyQkFBRCxDQUFWLENBQWpCLENBQ0EsS0FBTUMsT0FBTSwwQkFBR0QsT0FBTyxDQUFDLHVCQUFELENBQVAsQ0FBaUMsTUFBakMsQ0FBSCxDQUFaLENBQ0EsS0FBTUUsR0FBRSwwQkFBR0YsT0FBTyxDQUFDLElBQUQsQ0FBVixDQUFSLENBQ0EsS0FBTUcsT0FBTSwwQkFBR0gsT0FBTyxDQUFDLFFBQUQsQ0FBVixDQUFaLENBRUEsS0FBTUksT0FBTSwwQkFBRyxFQUFILENBQVosQ0FDQSxLQUFNQyxnQkFBZSwwQkFBRyxFQUFILENBQXJCLEMsd0JBRUEsR0FBSUYsTUFBTSxDQUFDRyxRQUFQLENBQWdCQyxVQUFoQixDQUEyQkMsT0FBM0IsR0FBdUMsTUFBM0MsQ0FBbUQsb0RBQy9DSixNQUFNLENBQUMsYUFBRCxDQUFOLENBQXdCTCxXQUFXLENBQUNVLEdBQVosQ0FBaUIsR0FBRU4sTUFBTSxDQUFDRyxRQUFQLENBQWdCQyxVQUFoQixDQUEyQkcsR0FBSSxtQkFBbEQsQ0FBc0UsQ0FDMUZDLFFBQVEsQ0FBRSxDQUFDQyxHQUFELENBQU1DLEdBQU4sR0FBYyx5QkFDcEIsS0FBTUMsT0FBTSwwQkFBR0YsR0FBRyw2QkFBRyxNQUFILDhCQUFZLDRCQUFBQyxHQUFHLENBQUNFLElBQUosQ0FBU0QsTUFBVCwrQkFBbUIsTUFBbkIsQ0FBWixDQUFOLENBQVosQ0FEb0Isd0JBRXBCLEdBQUlBLE1BQU0sR0FBSyxNQUFmLENBQXVCLHFEQUNuQmIsTUFBTSxDQUFDZSxJQUFQLENBQVkscUJBQVosRUFEbUIseUJBRW5CZixNQUFNLENBQUNlLElBQVAsQ0FBWUosR0FBWixFQUNILENBSEQsaUNBRm9CLHlCQU1wQixNQUFPRSxPQUFNLEdBQUssSUFBWCw2QkFBa0JmLFdBQVcsQ0FBQ2tCLEVBQVosRUFBbEIsOEJBQXFDbEIsV0FBVyxDQUFDbUIsSUFBWixFQUFyQyxDQUFQLENBQ0gsQ0FSeUYsQ0FTMUZDLE9BQU8sQ0FBRSxLQVRpRixDQVUxRkMsUUFBUSxDQUFFLEtBVmdGLENBQXRFLENBQXhCLENBWUgsQ0FiRCxpQyx5QkFlQSxLQUFNQyxNQUFLLENBQUdDLEdBQUcsRUFBSSxrREFDakJ2QixXQUFXLENBQUN3QixLQUFaLENBQWtCRCxHQUFsQixDQUF1QixDQUNuQmxCLE1BQU0sQ0FBRUEsTUFEVyxDQUVuQkMsZUFBZSxDQUFFQSxlQUZFLENBR25CbUIsU0FBUyxDQUFFLENBQ1BDLElBQUksQ0FBRXRCLE1BQU0sQ0FBQ3VCLE9BQVAsQ0FBZUQsSUFEZCxDQUVQRSxJQUFJLENBQUV6QixFQUFFLENBQUMwQixRQUFILEVBRkMsQ0FHUEMsTUFBTSxDQUFFQyxPQUFPLENBQUNELE1BQVIsRUFIRCxDQUhRLENBQXZCLEVBU0gsQ0FWRCxDLHlCQVlBRSxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsQ0FDYlgsS0FBSyxDQUFFQSxLQURNLENBQWpCIn0=