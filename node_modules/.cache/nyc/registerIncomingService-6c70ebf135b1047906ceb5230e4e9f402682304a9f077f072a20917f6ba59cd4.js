'use strict';function cov_1t1lecwf1(){var path="/Users/priyankaverma/IdeaProjects/pcq-frontend/app/middleware/registerIncomingService.js";var hash="e1fd4ef9fe63987d7bb13fb24315c82892f762f8";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/priyankaverma/IdeaProjects/pcq-frontend/app/middleware/registerIncomingService.js",statementMap:{"0":{start:{line:3,column:15},end:{line:3,column:55}},"1":{start:{line:4,column:13},end:{line:4,column:43}},"2":{start:{line:5,column:20},end:{line:5,column:57}},"3":{start:{line:6,column:27},end:{line:6,column:60}},"4":{start:{line:7,column:22},end:{line:7,column:64}},"5":{start:{line:10,column:22},end:{line:19,column:1}},"6":{start:{line:21,column:19},end:{line:52,column:1}},"7":{start:{line:22,column:20},end:{line:22,column:31}},"8":{start:{line:23,column:17},end:{line:23,column:29}},"9":{start:{line:25,column:4},end:{line:49,column:7}},"10":{start:{line:26,column:22},end:{line:26,column:43}},"11":{start:{line:27,column:8},end:{line:48,column:9}},"12":{start:{line:28,column:12},end:{line:47,column:13}},"13":{start:{line:31,column:20},end:{line:31,column:95}},"14":{start:{line:32,column:20},end:{line:32,column:26}},"15":{start:{line:36,column:20},end:{line:36,column:45}},"16":{start:{line:37,column:20},end:{line:37,column:26}},"17":{start:{line:39,column:20},end:{line:39,column:73}},"18":{start:{line:40,column:20},end:{line:40,column:26}},"19":{start:{line:43,column:20},end:{line:43,column:48}},"20":{start:{line:44,column:20},end:{line:44,column:26}},"21":{start:{line:46,column:20},end:{line:46,column:26}},"22":{start:{line:51,column:4},end:{line:51,column:61}},"23":{start:{line:54,column:27},end:{line:74,column:1}},"24":{start:{line:55,column:34},end:{line:55,column:36}},"25":{start:{line:57,column:4},end:{line:62,column:7}},"26":{start:{line:59,column:8},end:{line:61,column:9}},"27":{start:{line:60,column:12},end:{line:60,column:51}},"28":{start:{line:64,column:4},end:{line:73,column:5}},"29":{start:{line:65,column:8},end:{line:65,column:89}},"30":{start:{line:66,column:11},end:{line:73,column:5}},"31":{start:{line:67,column:8},end:{line:67,column:82}},"32":{start:{line:69,column:8},end:{line:69,column:57}},"33":{start:{line:70,column:8},end:{line:70,column:43}},"34":{start:{line:72,column:8},end:{line:72,column:56}},"35":{start:{line:76,column:25},end:{line:79,column:1}},"36":{start:{line:77,column:4},end:{line:78,column:98}},"37":{start:{line:78,column:36},end:{line:78,column:61}},"38":{start:{line:81,column:32},end:{line:91,column:1}},"39":{start:{line:82,column:4},end:{line:82,column:27}},"40":{start:{line:83,column:20},end:{line:83,column:37}},"41":{start:{line:84,column:4},end:{line:87,column:5}},"42":{start:{line:86,column:8},end:{line:86,column:63}},"43":{start:{line:88,column:4},end:{line:90,column:5}},"44":{start:{line:89,column:8},end:{line:89,column:32}},"45":{start:{line:93,column:0},end:{line:96,column:2}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:21,column:19},end:{line:21,column:20}},loc:{start:{line:21,column:26},end:{line:52,column:1}},line:21},"1":{name:"(anonymous_1)",decl:{start:{line:25,column:26},end:{line:25,column:27}},loc:{start:{line:25,column:35},end:{line:49,column:5}},line:25},"2":{name:"(anonymous_2)",decl:{start:{line:54,column:27},end:{line:54,column:28}},loc:{start:{line:54,column:34},end:{line:74,column:1}},line:54},"3":{name:"(anonymous_3)",decl:{start:{line:57,column:26},end:{line:57,column:27}},loc:{start:{line:57,column:35},end:{line:62,column:5}},line:57},"4":{name:"(anonymous_4)",decl:{start:{line:76,column:25},end:{line:76,column:26}},loc:{start:{line:76,column:40},end:{line:79,column:1}},line:76},"5":{name:"(anonymous_5)",decl:{start:{line:78,column:31},end:{line:78,column:32}},loc:{start:{line:78,column:36},end:{line:78,column:61}},line:78},"6":{name:"(anonymous_6)",decl:{start:{line:81,column:32},end:{line:81,column:33}},loc:{start:{line:81,column:41},end:{line:91,column:1}},line:81}},branchMap:{"0":{loc:{start:{line:27,column:8},end:{line:48,column:9}},type:"if",locations:[{start:{line:27,column:8},end:{line:48,column:9}},{start:{line:27,column:8},end:{line:48,column:9}}],line:27},"1":{loc:{start:{line:28,column:12},end:{line:47,column:13}},type:"switch",locations:[{start:{line:29,column:16},end:{line:29,column:33}},{start:{line:30,column:16},end:{line:32,column:26}},{start:{line:33,column:16},end:{line:33,column:29}},{start:{line:34,column:16},end:{line:34,column:33}},{start:{line:35,column:16},end:{line:37,column:26}},{start:{line:38,column:16},end:{line:40,column:26}},{start:{line:41,column:16},end:{line:41,column:32}},{start:{line:42,column:16},end:{line:44,column:26}},{start:{line:45,column:16},end:{line:46,column:26}}],line:28},"2":{loc:{start:{line:31,column:39},end:{line:31,column:94}},type:"cond-expr",locations:[{start:{line:31,column:67},end:{line:31,column:86}},{start:{line:31,column:89},end:{line:31,column:94}}],line:31},"3":{loc:{start:{line:51,column:19},end:{line:51,column:60}},type:"cond-expr",locations:[{start:{line:51,column:39},end:{line:51,column:56}},{start:{line:51,column:59},end:{line:51,column:60}}],line:51},"4":{loc:{start:{line:59,column:8},end:{line:61,column:9}},type:"if",locations:[{start:{line:59,column:8},end:{line:61,column:9}},{start:{line:59,column:8},end:{line:61,column:9}}],line:59},"5":{loc:{start:{line:59,column:12},end:{line:59,column:52}},type:"binary-expr",locations:[{start:{line:59,column:12},end:{line:59,column:26}},{start:{line:59,column:30},end:{line:59,column:52}}],line:59},"6":{loc:{start:{line:64,column:4},end:{line:73,column:5}},type:"if",locations:[{start:{line:64,column:4},end:{line:73,column:5}},{start:{line:64,column:4},end:{line:73,column:5}}],line:64},"7":{loc:{start:{line:66,column:11},end:{line:73,column:5}},type:"if",locations:[{start:{line:66,column:11},end:{line:73,column:5}},{start:{line:66,column:11},end:{line:73,column:5}}],line:66},"8":{loc:{start:{line:77,column:19},end:{line:78,column:96}},type:"binary-expr",locations:[{start:{line:77,column:19},end:{line:77,column:28}},{start:{line:78,column:8},end:{line:78,column:96}}],line:77},"9":{loc:{start:{line:84,column:4},end:{line:87,column:5}},type:"if",locations:[{start:{line:84,column:4},end:{line:87,column:5}},{start:{line:84,column:4},end:{line:87,column:5}}],line:84},"10":{loc:{start:{line:88,column:4},end:{line:90,column:5}},type:"if",locations:[{start:{line:88,column:4},end:{line:90,column:5}},{start:{line:88,column:4},end:{line:90,column:5}}],line:88}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},b:{"0":[0,0],"1":[0,0,0,0,0,0,0,0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"e1fd4ef9fe63987d7bb13fb24315c82892f762f8"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1t1lecwf1=function(){return actualCoverage;};}return actualCoverage;}cov_1t1lecwf1();const logger=(cov_1t1lecwf1().s[0]++,require('app/components/logger')('Init'));const auth=(cov_1t1lecwf1().s[1]++,require('app/components/auth'));const stringUtils=(cov_1t1lecwf1().s[2]++,require('../components/string-utils'));const registeredServices=(cov_1t1lecwf1().s[3]++,require('app/registeredServices'));const{verifyToken}=(cov_1t1lecwf1().s[4]++,require('app/components/encryption-token'));// This excludes the token as this is handled separately
const pcqParameters=(cov_1t1lecwf1().s[5]++,[{name:'serviceId',required:true},{name:'actor',required:true},{name:'pcqId',required:true},{name:'ccdCaseId',required:false},{name:'partyId',required:true},{name:'returnUrl',required:true},{name:'language',required:false},{name:'ageCheck',required:false}]);cov_1t1lecwf1().s[6]++;const setSession=req=>{cov_1t1lecwf1().f[0]++;const session=(cov_1t1lecwf1().s[7]++,req.session);const form=(cov_1t1lecwf1().s[8]++,session.form);cov_1t1lecwf1().s[9]++;pcqParameters.forEach(param=>{cov_1t1lecwf1().f[1]++;const value=(cov_1t1lecwf1().s[10]++,req.query[param.name]);cov_1t1lecwf1().s[11]++;if(value){cov_1t1lecwf1().b[0][0]++;cov_1t1lecwf1().s[12]++;switch(param.name){case'serviceId':cov_1t1lecwf1().b[1][0]++;case'actor':cov_1t1lecwf1().b[1][1]++;cov_1t1lecwf1().s[13]++;form[param.name]=typeof value==='string'?(cov_1t1lecwf1().b[2][0]++,value.toLowerCase()):(cov_1t1lecwf1().b[2][1]++,value);cov_1t1lecwf1().s[14]++;break;case'pcqId':cov_1t1lecwf1().b[1][2]++;case'ccdCaseId':cov_1t1lecwf1().b[1][3]++;case'partyId':cov_1t1lecwf1().b[1][4]++;cov_1t1lecwf1().s[15]++;form[param.name]=value;cov_1t1lecwf1().s[16]++;break;case'returnUrl':cov_1t1lecwf1().b[1][5]++;cov_1t1lecwf1().s[17]++;session[param.name]=stringUtils.prefixHttps(value);cov_1t1lecwf1().s[18]++;break;case'language':cov_1t1lecwf1().b[1][6]++;case'ageCheck':cov_1t1lecwf1().b[1][7]++;cov_1t1lecwf1().s[19]++;session[param.name]=value;cov_1t1lecwf1().s[20]++;break;default:cov_1t1lecwf1().b[1][8]++;cov_1t1lecwf1().s[21]++;break;}}else{cov_1t1lecwf1().b[0][1]++;}});cov_1t1lecwf1().s[22]++;form.channel=req.query.channel?(cov_1t1lecwf1().b[3][0]++,req.query.channel):(cov_1t1lecwf1().b[3][1]++,1);};cov_1t1lecwf1().s[23]++;const validateParameters=req=>{cov_1t1lecwf1().f[2]++;const missingRequiredParams=(cov_1t1lecwf1().s[24]++,[]);cov_1t1lecwf1().s[25]++;pcqParameters.forEach(param=>{cov_1t1lecwf1().f[3]++;cov_1t1lecwf1().s[26]++;// If a required parameter is missing
if((cov_1t1lecwf1().b[5][0]++,param.required)&&(cov_1t1lecwf1().b[5][1]++,!req.query[param.name])){cov_1t1lecwf1().b[4][0]++;cov_1t1lecwf1().s[27]++;missingRequiredParams.push(param.name);}else{cov_1t1lecwf1().b[4][1]++;}});cov_1t1lecwf1().s[28]++;if(missingRequiredParams.length>0){cov_1t1lecwf1().b[6][0]++;cov_1t1lecwf1().s[29]++;logger.error('Missing required parameters: '+missingRequiredParams.join(', '));}else{cov_1t1lecwf1().b[6][1]++;cov_1t1lecwf1().s[30]++;if(!validatedService(req.query.serviceId)){cov_1t1lecwf1().b[7][0]++;cov_1t1lecwf1().s[31]++;logger.error(`Service ${req.query.serviceId} is not registered with PCQ`);}else{cov_1t1lecwf1().b[7][1]++;cov_1t1lecwf1().s[32]++;logger.info('Parameters verified successfully.');cov_1t1lecwf1().s[33]++;req.session.validParameters=true;// Create the JWT Token after the required parameters have been set.
cov_1t1lecwf1().s[34]++;auth.createToken(req,req.session.form.partyId);}}};cov_1t1lecwf1().s[35]++;const validatedService=serviceId=>{cov_1t1lecwf1().f[4]++;cov_1t1lecwf1().s[36]++;return Boolean((cov_1t1lecwf1().b[8][0]++,serviceId)&&(cov_1t1lecwf1().b[8][1]++,registeredServices.map(s=>{cov_1t1lecwf1().f[5]++;cov_1t1lecwf1().s[37]++;return s.serviceId.toLowerCase();}).includes(serviceId.toLowerCase())));};cov_1t1lecwf1().s[38]++;const registerIncomingService=req=>{cov_1t1lecwf1().f[6]++;cov_1t1lecwf1().s[39]++;logger.info(req.query);const partyId=(cov_1t1lecwf1().s[40]++,req.query.partyId);cov_1t1lecwf1().s[41]++;if(partyId){cov_1t1lecwf1().b[9][0]++;cov_1t1lecwf1().s[42]++;// Ensure emails are properly encoded
req.query.partyId=partyId.trim().replace(/\s/g,'+');}else{cov_1t1lecwf1().b[9][1]++;}cov_1t1lecwf1().s[43]++;if(verifyToken(req.query)){cov_1t1lecwf1().b[10][0]++;cov_1t1lecwf1().s[44]++;validateParameters(req);}else{cov_1t1lecwf1().b[10][1]++;}};cov_1t1lecwf1().s[45]++;module.exports={registerIncomingService,setSession};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJsb2dnZXIiLCJyZXF1aXJlIiwiYXV0aCIsInN0cmluZ1V0aWxzIiwicmVnaXN0ZXJlZFNlcnZpY2VzIiwidmVyaWZ5VG9rZW4iLCJwY3FQYXJhbWV0ZXJzIiwibmFtZSIsInJlcXVpcmVkIiwic2V0U2Vzc2lvbiIsInJlcSIsInNlc3Npb24iLCJmb3JtIiwiZm9yRWFjaCIsInBhcmFtIiwidmFsdWUiLCJxdWVyeSIsInRvTG93ZXJDYXNlIiwicHJlZml4SHR0cHMiLCJjaGFubmVsIiwidmFsaWRhdGVQYXJhbWV0ZXJzIiwibWlzc2luZ1JlcXVpcmVkUGFyYW1zIiwicHVzaCIsImxlbmd0aCIsImVycm9yIiwiam9pbiIsInZhbGlkYXRlZFNlcnZpY2UiLCJzZXJ2aWNlSWQiLCJpbmZvIiwidmFsaWRQYXJhbWV0ZXJzIiwiY3JlYXRlVG9rZW4iLCJwYXJ0eUlkIiwiQm9vbGVhbiIsIm1hcCIsInMiLCJpbmNsdWRlcyIsInJlZ2lzdGVySW5jb21pbmdTZXJ2aWNlIiwidHJpbSIsInJlcGxhY2UiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsicmVnaXN0ZXJJbmNvbWluZ1NlcnZpY2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBsb2dnZXIgPSByZXF1aXJlKCdhcHAvY29tcG9uZW50cy9sb2dnZXInKSgnSW5pdCcpO1xuY29uc3QgYXV0aCA9IHJlcXVpcmUoJ2FwcC9jb21wb25lbnRzL2F1dGgnKTtcbmNvbnN0IHN0cmluZ1V0aWxzID0gcmVxdWlyZSgnLi4vY29tcG9uZW50cy9zdHJpbmctdXRpbHMnKTtcbmNvbnN0IHJlZ2lzdGVyZWRTZXJ2aWNlcyA9IHJlcXVpcmUoJ2FwcC9yZWdpc3RlcmVkU2VydmljZXMnKTtcbmNvbnN0IHt2ZXJpZnlUb2tlbn0gPSByZXF1aXJlKCdhcHAvY29tcG9uZW50cy9lbmNyeXB0aW9uLXRva2VuJyk7XG5cbi8vIFRoaXMgZXhjbHVkZXMgdGhlIHRva2VuIGFzIHRoaXMgaXMgaGFuZGxlZCBzZXBhcmF0ZWx5XG5jb25zdCBwY3FQYXJhbWV0ZXJzID0gW1xuICAgIHtuYW1lOiAnc2VydmljZUlkJywgcmVxdWlyZWQ6IHRydWV9LFxuICAgIHtuYW1lOiAnYWN0b3InLCByZXF1aXJlZDogdHJ1ZX0sXG4gICAge25hbWU6ICdwY3FJZCcsIHJlcXVpcmVkOiB0cnVlfSxcbiAgICB7bmFtZTogJ2NjZENhc2VJZCcsIHJlcXVpcmVkOiBmYWxzZX0sXG4gICAge25hbWU6ICdwYXJ0eUlkJywgcmVxdWlyZWQ6IHRydWV9LFxuICAgIHtuYW1lOiAncmV0dXJuVXJsJywgcmVxdWlyZWQ6IHRydWV9LFxuICAgIHtuYW1lOiAnbGFuZ3VhZ2UnLCByZXF1aXJlZDogZmFsc2V9LFxuICAgIHtuYW1lOiAnYWdlQ2hlY2snLCByZXF1aXJlZDogZmFsc2V9XG5dO1xuXG5jb25zdCBzZXRTZXNzaW9uID0gcmVxID0+IHtcbiAgICBjb25zdCBzZXNzaW9uID0gcmVxLnNlc3Npb247XG4gICAgY29uc3QgZm9ybSA9IHNlc3Npb24uZm9ybTtcblxuICAgIHBjcVBhcmFtZXRlcnMuZm9yRWFjaChwYXJhbSA9PiB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gcmVxLnF1ZXJ5W3BhcmFtLm5hbWVdO1xuICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgIHN3aXRjaCAocGFyYW0ubmFtZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3NlcnZpY2VJZCc6XG4gICAgICAgICAgICAgICAgY2FzZSAnYWN0b3InOlxuICAgICAgICAgICAgICAgICAgICBmb3JtW3BhcmFtLm5hbWVdID0gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyA/IHZhbHVlLnRvTG93ZXJDYXNlKCkgOiB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAncGNxSWQnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2NjZENhc2VJZCc6XG4gICAgICAgICAgICAgICAgY2FzZSAncGFydHlJZCc6XG4gICAgICAgICAgICAgICAgICAgIGZvcm1bcGFyYW0ubmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAncmV0dXJuVXJsJzpcbiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbltwYXJhbS5uYW1lXSA9IHN0cmluZ1V0aWxzLnByZWZpeEh0dHBzKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnbGFuZ3VhZ2UnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2FnZUNoZWNrJzpcbiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbltwYXJhbS5uYW1lXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgZm9ybS5jaGFubmVsID0gcmVxLnF1ZXJ5LmNoYW5uZWwgPyByZXEucXVlcnkuY2hhbm5lbCA6IDE7XG59O1xuXG5jb25zdCB2YWxpZGF0ZVBhcmFtZXRlcnMgPSByZXEgPT4ge1xuICAgIGNvbnN0IG1pc3NpbmdSZXF1aXJlZFBhcmFtcyA9IFtdO1xuXG4gICAgcGNxUGFyYW1ldGVycy5mb3JFYWNoKHBhcmFtID0+IHtcbiAgICAgICAgLy8gSWYgYSByZXF1aXJlZCBwYXJhbWV0ZXIgaXMgbWlzc2luZ1xuICAgICAgICBpZiAocGFyYW0ucmVxdWlyZWQgJiYgIXJlcS5xdWVyeVtwYXJhbS5uYW1lXSkge1xuICAgICAgICAgICAgbWlzc2luZ1JlcXVpcmVkUGFyYW1zLnB1c2gocGFyYW0ubmFtZSk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGlmIChtaXNzaW5nUmVxdWlyZWRQYXJhbXMubGVuZ3RoID4gMCkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ01pc3NpbmcgcmVxdWlyZWQgcGFyYW1ldGVyczogJyArIG1pc3NpbmdSZXF1aXJlZFBhcmFtcy5qb2luKCcsICcpKTtcbiAgICB9IGVsc2UgaWYgKCF2YWxpZGF0ZWRTZXJ2aWNlKHJlcS5xdWVyeS5zZXJ2aWNlSWQpKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcihgU2VydmljZSAke3JlcS5xdWVyeS5zZXJ2aWNlSWR9IGlzIG5vdCByZWdpc3RlcmVkIHdpdGggUENRYCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgbG9nZ2VyLmluZm8oJ1BhcmFtZXRlcnMgdmVyaWZpZWQgc3VjY2Vzc2Z1bGx5LicpO1xuICAgICAgICByZXEuc2Vzc2lvbi52YWxpZFBhcmFtZXRlcnMgPSB0cnVlO1xuICAgICAgICAvLyBDcmVhdGUgdGhlIEpXVCBUb2tlbiBhZnRlciB0aGUgcmVxdWlyZWQgcGFyYW1ldGVycyBoYXZlIGJlZW4gc2V0LlxuICAgICAgICBhdXRoLmNyZWF0ZVRva2VuKHJlcSwgcmVxLnNlc3Npb24uZm9ybS5wYXJ0eUlkKTtcbiAgICB9XG59O1xuXG5jb25zdCB2YWxpZGF0ZWRTZXJ2aWNlID0gKHNlcnZpY2VJZCkgPT4ge1xuICAgIHJldHVybiBCb29sZWFuKHNlcnZpY2VJZCAmJlxuICAgICAgICByZWdpc3RlcmVkU2VydmljZXMubWFwKHMgPT4gcy5zZXJ2aWNlSWQudG9Mb3dlckNhc2UoKSkuaW5jbHVkZXMoc2VydmljZUlkLnRvTG93ZXJDYXNlKCkpKTtcbn07XG5cbmNvbnN0IHJlZ2lzdGVySW5jb21pbmdTZXJ2aWNlID0gKHJlcSkgPT4ge1xuICAgIGxvZ2dlci5pbmZvKHJlcS5xdWVyeSk7XG4gICAgY29uc3QgcGFydHlJZCA9IHJlcS5xdWVyeS5wYXJ0eUlkO1xuICAgIGlmIChwYXJ0eUlkKSB7XG4gICAgICAgIC8vIEVuc3VyZSBlbWFpbHMgYXJlIHByb3Blcmx5IGVuY29kZWRcbiAgICAgICAgcmVxLnF1ZXJ5LnBhcnR5SWQgPSBwYXJ0eUlkLnRyaW0oKS5yZXBsYWNlKC9cXHMvZywgJysnKTtcbiAgICB9XG4gICAgaWYgKHZlcmlmeVRva2VuKHJlcS5xdWVyeSkpIHtcbiAgICAgICAgdmFsaWRhdGVQYXJhbWV0ZXJzKHJlcSk7XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgcmVnaXN0ZXJJbmNvbWluZ1NlcnZpY2UsXG4gICAgc2V0U2Vzc2lvblxufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUEsYSxtbU9BZVk7eUZBYlosS0FBTUEsT0FBTSx5QkFBR0MsT0FBTyxDQUFDLHVCQUFELENBQVAsQ0FBaUMsTUFBakMsQ0FBSCxDQUFaLENBQ0EsS0FBTUMsS0FBSSx5QkFBR0QsT0FBTyxDQUFDLHFCQUFELENBQVYsQ0FBVixDQUNBLEtBQU1FLFlBQVcseUJBQUdGLE9BQU8sQ0FBQyw0QkFBRCxDQUFWLENBQWpCLENBQ0EsS0FBTUcsbUJBQWtCLHlCQUFHSCxPQUFPLENBQUMsd0JBQUQsQ0FBVixDQUF4QixDQUNBLEtBQU0sQ0FBQ0ksV0FBRCwwQkFBZ0JKLE9BQU8sQ0FBQyxpQ0FBRCxDQUF2QixDQUFOLENBRUE7QUFDQSxLQUFNSyxjQUFhLHlCQUFHLENBQ2xCLENBQUNDLElBQUksQ0FBRSxXQUFQLENBQW9CQyxRQUFRLENBQUUsSUFBOUIsQ0FEa0IsQ0FFbEIsQ0FBQ0QsSUFBSSxDQUFFLE9BQVAsQ0FBZ0JDLFFBQVEsQ0FBRSxJQUExQixDQUZrQixDQUdsQixDQUFDRCxJQUFJLENBQUUsT0FBUCxDQUFnQkMsUUFBUSxDQUFFLElBQTFCLENBSGtCLENBSWxCLENBQUNELElBQUksQ0FBRSxXQUFQLENBQW9CQyxRQUFRLENBQUUsS0FBOUIsQ0FKa0IsQ0FLbEIsQ0FBQ0QsSUFBSSxDQUFFLFNBQVAsQ0FBa0JDLFFBQVEsQ0FBRSxJQUE1QixDQUxrQixDQU1sQixDQUFDRCxJQUFJLENBQUUsV0FBUCxDQUFvQkMsUUFBUSxDQUFFLElBQTlCLENBTmtCLENBT2xCLENBQUNELElBQUksQ0FBRSxVQUFQLENBQW1CQyxRQUFRLENBQUUsS0FBN0IsQ0FQa0IsQ0FRbEIsQ0FBQ0QsSUFBSSxDQUFFLFVBQVAs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